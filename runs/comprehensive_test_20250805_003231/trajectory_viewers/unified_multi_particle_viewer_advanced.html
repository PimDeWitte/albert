<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Multi-Particle Trajectory Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
        }
        
        #canvas-container {
            width: 100vw;
            height: 100vh;
        }
        
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            max-width: 350px;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        .info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            max-width: 400px;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        h3 {
            margin: 0 0 15px 0;
            font-size: 18px;
            color: #4a9eff;
        }
        
        .theory-selector {
            margin: 10px 0;
        }
        
        .theory-selector select {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            background: #1a1a1a;
            color: white;
            border: 1px solid #333;
            font-size: 14px;
        }
        
        .button {
            background: #2980b9;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .button:hover {
            background: #3498db;
        }
        
        .button.active {
            background: #e74c3c;
        }
        
        .button.primary {
            background: #27ae60;
        }
        
        .button.mounted {
            background: #f39c12;
        }
        
        .slider-container {
            margin: 10px 0;
        }
        
        .slider {
            width: 100%;
            margin: 5px 0;
        }
        
        .particle-control {
            background: #1a1a1a;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border: 1px solid #333;
        }
        
        .particle-control.primary {
            border-color: #27ae60;
        }
        
        .particle-control.mounted {
            border-color: #f39c12;
        }
        
        .particle-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .particle-actions {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        
        .particle-toggle {
            margin-right: 10px;
        }
        
        .particle-toggle input {
            margin-right: 5px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
        }
        
        .spacetime-info {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border: 1px solid #333;
        }
        
        .tensor-info {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border: 1px solid #333;
            font-family: monospace;
            font-size: 12px;
        }
        
        .view-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            display: none;
            border: 1px solid #4a9eff;
            max-width: 300px;
        }
        
        .object-info {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 6px;
            display: none;
            max-width: 350px;
        }
        
        .grid-toggle {
            margin: 10px 0;
        }
        
        .degrees-of-freedom {
            margin-top: 10px;
            padding: 10px;
            background: #2a2a2a;
            border-radius: 4px;
        }
        
        .dof-item {
            margin: 5px 0;
            font-size: 12px;
        }
        
        /* Scrollbar styling */
        .controls::-webkit-scrollbar,
        .info::-webkit-scrollbar {
            width: 8px;
        }
        
        .controls::-webkit-scrollbar-track,
        .info::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        .controls::-webkit-scrollbar-thumb,
        .info::-webkit-scrollbar-thumb {
            background: #4a9eff;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    
    <div class="controls">
        <h3>Theory Selection</h3>
        <div class="theory-selector">
            <select id="theorySelect">
                <option value="">Select Theory...</option>
            </select>
        </div>
        
        <h3 style="margin-top: 20px;">Compare Trajectories</h3>
        <div class="theory-selector">
            <select id="overlaySelect">
                <option value="">No Overlay...</option>
            </select>
        </div>
        
        <h3 style="margin-top: 20px;">View Controls</h3>
        <button class="button" onclick="setView('third')">Third Person</button>
        <button class="button" onclick="setView('top')">Top View</button>
        <button class="button" onclick="resetCamera()">Reset View</button>
        
        <div class="grid-toggle">
            <label>
                <input type="checkbox" id="gridToggle" checked onchange="toggleSpacetimeGrid()">
                Show Spacetime Grid
            </label>
        </div>
        
        <h3 style="margin-top: 20px;">Animation</h3>
        <button class="button" id="playPauseBtn" onclick="toggleAnimation()">Pause</button>
        <button class="button" onclick="resetAnimation()">Reset</button>
        
        <div class="slider-container">
            <label>Speed: <span id="speedValue">1.0</span>x</label>
            <input type="range" class="slider" id="speedSlider" min="0.1" max="5" step="0.1" value="1">
        </div>
        
        <div class="slider-container">
            <label>Time: <span id="timeValue">0</span>%</label>
            <input type="range" class="slider" id="timeSlider" min="0" max="100" step="0.1" value="0">
        </div>
        
        <h3 style="margin-top: 20px;">Particles</h3>
        <div id="particleControls"></div>
    </div>
    
    <div class="info">
        <h3 id="theoryNameDisplay">No Theory Selected</h3>
        <p>Black Hole Mass: <span id="blackHoleMass">99450000000000.0</span> kg</p>
        <p>Schwarzschild Radius: <span id="schwarzschildRadius"></span> M</p>
        
        <div class="spacetime-info">
            <h4>Spacetime at Camera</h4>
            <p>Distance from BH: <span id="cameraDistance">-</span> M</p>
            <p>Proper Time Factor: <span id="properTimeFactor">-</span></p>
            <p>Spatial Curvature: <span id="spatialCurvature">-</span></p>
            <p id="spacetimeDescription">Move camera to see spacetime effects</p>
        </div>
        
        <h3 style="margin-top: 15px;">Legend</h3>
        <div id="legend"></div>
        
        <div style="margin-top: 15px; padding: 10px; background: #1a1a1a; border-radius: 6px;">
            <h4 style="margin: 0 0 10px 0; color: #4a9eff;">Spacetime Grid Visualization</h4>
            <p style="font-size: 12px; margin: 5px 0;">
                <strong>Green Grid:</strong> Flamm's paraboloid - the proper embedding of Schwarzschild spacetime<br>
                <strong>Curvature Formula:</strong> z = 2√(2M(r-2M)) where M = GM/c²<br>
                <strong>Grid Density:</strong> Logarithmic spacing - denser near black hole for detail<br>
                <strong>Funnel Shape:</strong> Shows how space is curved into the black hole<br>
                <strong>Key Radii:</strong> Red = Event Horizon (2M), Orange = Photon Sphere (3M), Yellow = ISCO (6M)<br>
                <strong>Note:</strong> This is a 2D spatial slice embedded in 3D to visualize curvature
            </p>
        </div>
        
        <div id="particleTensorInfo" class="tensor-info" style="display: none;">
            <h4>Particle State</h4>
            <div id="tensorContent"></div>
            <div class="degrees-of-freedom">
                <h5>Degrees of Freedom</h5>
                <div id="dofContent"></div>
            </div>
        </div>
    </div>
    
            <div class="view-info" id="viewInfo">
            Top View - Looking down at orbital plane
        </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <div class="object-info" id="objectInfo"></div>

    <script>
        // Run data containing all theories
        const runData = {"UGM \u03b1=[1.01.01.01.0] g=1.00e-01": {"name": "UGM_\u03b1=[1.01.01.01.0]_g=1.00e-01", "category": "classical", "particles": {"electron": {"positions": [[100.55304172951233, 0.0], [100.55195238730396, 3.1325263715152365e-05], [100.54868427854176, 6.26518849537532e-05], [100.54323716133351, 9.398122160638302e-05], [100.53561062483345, 0.0001253146322924664], [100.52580409363838, 0.00015665347673951327], [100.51381683211446, 0.0001879991161404227], [100.49964793500031, 0.00021935291352883707], [100.48329633160755, 0.00025071623415009954], [100.46476078082495, 0.00028209044583375027], [100.44403987978707, 0.0003134769193735436], [100.4211320587344, 0.0003448770288923756], [100.39603557582394, 0.00037629215223243745], [100.36874852561465, 0.0004077236713307858], [100.3392688337325, 0.0004391729726035134], [100.30759426068278, 0.00047064144733307086], [100.2737223917009, 0.000502130492053203], [100.23765063579063, 0.0005336415089550442], [100.19937623395937, 0.000565175906279794], [100.15889625348603, 0.000596735098721506], [100.11620759144769, 0.0006283205078344852], [100.07130696407448, 0.0006599335624396615], [100.0241909054219, 0.000691575699053997], [99.97485578012659, 0.0007232483623076636], [99.92329776772851, 0.0007549530053669983], [99.86951286110883, 0.0007866910903817556], [99.81349687436052, 0.0008184640889208757], [99.75524544115198, 0.0008502734824211948], [99.69475400811679, 0.0008821207626372701], [99.6320178232463, 0.0009140074321111664], [99.56703194848559, 0.0009459350046504459], [99.49979125274236, 0.0009779050057958589], [99.43029040486347, 0.0010099189733229917], [99.35852388618984, 0.001041978457734345], [99.28448597332964, 0.0010740850227609737], [99.2081707357027, 0.0011062402458936415], [99.12957204297464, 0.0011384457189053338], [99.04868355741704, 0.0011707030483913375], [98.96549873629706, 0.0012030138563209624], [98.88001082390413, 0.001235379780594686], [98.79221284341861, 0.001267802475627378], [98.70209759367194, 0.0013002836129381396], [98.60965765114273, 0.0013328248817609275], [98.51488537188054, 0.001365427989655853], [98.41777288820145, 0.0013980946631423831], [98.31831209434237, 0.0014308266483410961], [98.2164946427174, 0.0014636257116532722], [98.11231195081504, 0.0014964936404361848], [98.00575519736981, 0.0015294322437033419], [97.89681531269943, 0.001562443352835815], [97.78548296316272, 0.0015955288223278132], [97.67174855780443, 0.001628690530552797], [97.55560224939133, 0.0016619303805354491], [97.43703392399874, 0.0016952503007531682], [97.31603319603377, 0.0017286522459604788], [97.19258940307756, 0.0017621381980373466], [97.06669160053977, 0.0017957101668624209], [96.938328556119, 0.0018293701912122798], [96.80748874406146, 0.0018631203396877996], [96.67416034541593, 0.0018969627116688214], [96.53833122946868, 0.0019308994382896186], [96.39998895367607, 0.001964932683471273], [96.2591207631999, 0.0019990646449511854], [96.11571356497518, 0.0020332975553725863], [95.96975393327132, 0.002067633683409614], [95.82122810881917, 0.0021020753349106466], [95.67012198473103, 0.002136624854088932], [95.51642110539652, 0.0021712846247531636], [95.36011064458833, 0.002206057071569822], [95.20117540390882, 0.002240944661398956], [95.03959980358631, 0.002275949904635518], [94.87536786640571, 0.0023110753566391957], [94.70846322221873, 0.0023463236191833157], [94.53886909100964, 0.0023816973419661922], [94.36656827260339, 0.0024171992241771023], [94.1915431436312, 0.002452832016119456], [94.01377563114062, 0.00248859852088221], [93.83324720102006, 0.002524501596108822], [93.64993886133952, 0.0025605441557972806], [93.46383114223633, 0.0025967291721805605], [93.27490408296023, 0.002633059677679331], [93.08313722682793, 0.00266953876693045], [92.8885095903801, 0.0027061695988816834], [92.69099964874859, 0.002742955399009596], [92.49058534623337, 0.0027798994615855594], [92.28724405434741, 0.002817005152032678], [92.08095255530353, 0.0028542759094220787], [91.87168704265062, 0.0028917152490284784], [91.6594230945302, 0.002929326765006801], [91.4441356550513, 0.0029671141331813248], [91.22579902480449, 0.003005081113953284], [91.00438682076742, 0.0030432315553165367], [90.77987195509341, 0.003081569396054357], [90.55222663294649, 0.003120098669025255], [90.32142231951912, 0.0031588235046112485], [90.08742971595518, 0.0031977481343201937], [89.85021873418737, 0.0032368768945507153], [89.60975847062886, 0.0032762142305288494], [89.36601717865625, 0.003315764700426096], [89.11896225185795, 0.0033555329796692377], [88.86856016985905, 0.0033955238654312875], [88.61477647927224, 0.003435742281401687], [88.35757577249646, 0.0034761932826963583], [88.09692161509258, 0.0035168820610747948], [87.83277653459614, 0.0035578139504150058], [87.565101995649, 0.0035989944324110322], [87.2938583470099, 0.0036404291425810946], [87.0190047794753, 0.0036821238765806915], [86.74049928165756, 0.00372408459683973], [86.45829859348586, 0.0037663174395441844], [86.17235815728561, 0.0038088287219843102], [85.88263206628109, 0.0038516249502931104], [85.58907301035376, 0.003894712827600572], [85.29163221887609, 0.003938099262631172], [84.99025940042614, 0.003981791378774303], [84.68490267917277, 0.004025796523659645], [84.37550852770438, 0.0040701222792720575], [84.06202169605528, 0.004114776472643402], [83.74438513666382, 0.004159767187161791], [83.42253992497338, 0.004205102774542112], [83.09642517536363, 0.00425079186750542], [82.76597795207144, 0.004296843393218831], [82.43113317473221, 0.004343266587552046], [82.0918235181386, 0.004390071010211574], [81.74797930577812, 0.004437266560819125], [81.39952839667073, 0.0044848634960066944], [81.04639606498372, 0.004532872447607448], [80.68850487185158, 0.004581304442028892], [80.32577452877435, 0.004630170920902931], [79.95812175190822, 0.004679483763116442], [79.58546010649316, 0.004729255308336058], [79.20769984058892, 0.004779498382151979], [78.82474770720626, 0.004830226322978138], [78.43650677382608, 0.004881453010859898], [78.04287621819499, 0.004933192898356054], [77.64375110916716, 0.004985461043679308], [77.23902217123006, 0.0050382731462989445], [76.82857553120247, 0.005091645585231411], [76.41229244542403, 0.005145595460269258], [75.99004900556557, 0.00520014063642683], [75.56171582097286, 0.005255299791912668], [75.12715767521144, 0.00531109246997436], [74.68623315420031, 0.0053675391350022], [74.23879424300428, 0.005424661233324208], [73.78468588798971, 0.0054824812591777565], [73.32374552063128, 0.005541022826403269], [72.85580253877664, 0.00560031074647445], [72.38067774062371, 0.0056603711135587275], [71.89818270602487, 0.005721231397392864], [71.40811911899343, 0.0057829205448640016], [70.91027802442566, 0.005845469091308442], [70.4044390110496, 0.005908909282682062], [69.89036931143794, 0.005973275209921288], [69.36782280854628, 0.0060386029570063185], [68.836538936617, 0.0061049307644642815], [68.29624146237333, 0.006172299210315838], [67.74663713015653, 0.006240751410782609], [67.18741415195252, 0.0063103332434447015], [66.61824052001752, 0.006381093595980018], [66.03876211592511, 0.006453084644145651], [65.44860058516419, 0.006526362163295713], [64.84735094072884, 0.006600985878494289], [64.23457885220587, 0.00667701985920775], [63.609817568368406, 0.006754532965687206], [62.97256441081267, 0.006833599355530365], [62.322276763191205, 0.006914299060608344], [61.65836746857379, 0.0069967186466372054], [60.98019950212446, 0.007080951970311215], [60.28707982289953, 0.0071671010521697255], [59.57825219919106, 0.007255277087500459], [58.85288878339899, 0.007345601622920458], [58.11008022865238, 0.007438207932976618], [57.348823944625934, 0.00753324263986452], [56.56801009070927, 0.007630867630853556], [55.76640474023154, 0.007731262343065661], [54.942629484881, 0.0078346265054043], [54.09513651444994, 0.007941183454617253], [53.22217790891356, 0.008051184179593916], [52.32176726201649, 0.008164912299747508], [51.39163149756218, 0.00828269025565891], [50.429149252657794, 0.008404887094025246], [49.43127117117076, 0.008531928380838669], [48.39441511938499, 0.008664309002311953], [47.31432596558334, 0.008802609957410626], [46.18588410265016, 0.008947520784790167], [45.00283805185196, 0.009099870135438856], [43.7574194045744, 0.009260668456544432], [42.439774119252505, 0.009431169268915749], [41.037083578858756, 0.009612960117982582], [39.53214773296922, 0.00980810314004014], [37.90095994086634, 0.010019363485166603], [36.10823246911609, 0.010250605130436555], [34.09826099416222, 0.010507537986533153], [31.773364674309388, 0.01079930900233102], [28.929902944962848, 0.011142588057752], [24.962529604662905, 0.01157646459454296], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0]], "velocities": [], "times": [0.0, 3.128876105920594e-22, 6.257769161080025e-22, 9.386696118749967e-22, 1.2515673940199575e-21, 1.5644719598877948e-21, 1.8773850084321123e-21, 2.190308240628236e-21, 2.503243359880489e-21, 2.816192072431073e-21, 3.129156087777969e-21, 3.4421371190735784e-21, 3.7551368835543766e-21, 4.068157102951828e-21, 4.381199503913446e-21, 4.6942658184271505e-21, 5.00735778424193e-21, 5.320477145314154e-21, 5.633625652236314e-21, 5.946805062677501e-21, 6.260017141828688e-21, 6.573263662845737e-21, 6.886546407320034e-21, 7.199867165732762e-21, 7.513227737915159e-21, 7.826629933537783e-21, 8.140075572584124e-21, 8.453566485838923e-21, 8.7671045153764e-21, 9.080691515071758e-21, 9.394329351121235e-21, 9.708019902547649e-21, 1.0021765061746345e-20, 1.0335566735017361e-20, 1.0649426843107515e-20, 1.0963347321787071e-20, 1.127733012241352e-20, 1.1591377212514917e-20, 1.1905490576385299e-20, 1.2219672215684404e-20, 1.2533924150067133e-20, 1.2848248417818561e-20, 1.3162647076511866e-20, 1.3477122203664229e-20, 1.37916758974168e-20, 1.4106310277222135e-20, 1.4421027484575086e-20, 1.473582968373499e-20, 1.5050719062475123e-20, 1.5365697832842144e-20, 1.5680768231953962e-20, 1.5995932522818882e-20, 1.631119299515782e-20, 1.662655196625854e-20, 1.694201178185362e-20, 1.72575748170231e-20, 1.75732434771229e-20, 1.788902019874013e-20, 1.8204907450676402e-20, 1.8520907734960356e-20, 1.8837023587880008e-20, 1.9153257581078858e-20, 1.9469612322642275e-20, 1.97860904582509e-20, 2.010269467237079e-20, 2.0419427689458848e-20, 2.0736292275218786e-20, 2.1053291237898243e-20, 2.1370427429616768e-20, 2.1687703747775036e-20, 2.200512313646228e-20, 2.2322688587962467e-20, 2.2640403144274322e-20, 2.2958269898697547e-20, 2.3276291997475272e-20, 2.3594472641495294e-20, 2.391281508803886e-20, 2.4231322652636092e-20, 2.454999871094698e-20, 2.486884670072722e-20, 2.5187870123868257e-20, 2.5507072548515262e-20, 2.5826457611250783e-20, 2.614602901941195e-20, 2.6465790553450112e-20, 2.6785746069383724e-20, 2.710589950140176e-20, 2.742625486452058e-20, 2.774681625736766e-20, 2.806758786508072e-20, 2.83885739623286e-20, 2.8709778916440314e-20, 2.9031207190728306e-20, 2.935286334789485e-20, 2.967475205360807e-20, 2.999687808023605e-20, 3.0319246310748036e-20, 3.0641861742791835e-20, 3.0964729492957653e-20, 3.128785480123884e-20, 3.161124303567542e-20, 3.193489969729448e-20, 3.2258830425180845e-20, 3.2583041001873577e-20, 3.290753735902769e-20, 3.3232325583297734e-20, 3.3557411922544324e-20, 3.388280279235451e-20, 3.42085047828956e-20, 3.453452466612379e-20, 3.486086940337033e-20, 3.5187546153329797e-20, 3.551456228047708e-20, 3.584192536394147e-20, 3.616964320686889e-20, 3.6497723846305375e-20, 3.6826175563638067e-20, 3.715500689563255e-20, 3.7484226646108954e-20, 3.781384389830256e-20, 3.814386802795881e-20, 3.847430871721683e-20, 3.8805175969340286e-20, 3.9136480124359893e-20, 3.946823187569739e-20, 3.980044228784756e-20, 4.013312281520165e-20, 4.04662853221038e-20, 4.0799942104240564e-20, 4.113410591147354e-20, 4.14687899722359e-20, 4.180400801962584e-20, 4.2139774319343425e-20, 4.24761036996325e-20, 4.281301158340647e-20, 4.3150514022755565e-20, 4.3488627736055196e-20, 4.382737014791876e-20, 4.416675943226594e-20, 4.4506814558808565e-20, 4.48475553432912e-20, 4.5189002501863535e-20, 4.553117771000755e-20, 4.587410366649407e-20, 4.621780416290322e-20, 4.6562304159311484e-20, 4.6907629866826734e-20, 4.725380883774346e-20, 4.760087006419523e-20, 4.794884408630317e-20, 4.8297763110961134e-20, 4.864766114256336e-20, 4.899857412717404e-20, 4.9350540111866104e-20, 4.9703599421224263e-20, 5.005779485332535e-20, 5.0413171897885943e-20, 5.076977897971747e-20, 5.112766773116776e-20, 5.148689329787732e-20, 5.1847514682962204e-20, 5.2209595135688857e-20, 5.2573202591869554e-20, 5.2938410174636367e-20, 5.3305296766016195e-20, 5.367394766192278e-20, 5.4044455325918495e-20, 5.441692026057622e-20, 5.479145201962667e-20, 5.51681703896658e-20, 5.554720677749078e-20, 5.592870584845912e-20, 5.631282747360378e-20, 5.669974905966363e-20, 5.708966835811296e-20, 5.748280687911182e-20, 5.787941407733289e-20, 5.827977253382189e-20, 5.868420443943364e-20, 5.909307980213901e-20, 5.950682697237189e-20, 5.992594633885988e-20, 6.035102844336285e-20, 6.078277838763787e-20, 6.122204942119271e-20, 6.166989030437846e-20, 6.212761403003734e-20, 6.25969009489852e-20, 6.307995992753464e-20, 6.357979304193727e-20, 6.41006583915022e-20, 6.464894792006637e-20, 6.523504735858592e-20, 6.5877967099342e-20, 6.662036189470008e-20, 6.761522257350061e-20, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], "losses": []}, "neutrino": {"positions": [[100.55304172951233, 0.0], [100.52015113134047, 3.762843475869601e-05], [100.48507297720714, 7.52823214268599e-05], [100.44780460891256, 0.00011296332770798879], [100.40834319736635, 0.0001506731287251881], [100.36668573683276, 0.00018841340749841087], [100.32282905300181, 0.00022618585543428168], [100.27676979706229, 0.00026399217280097823], [100.22850443973797, 0.0003018340692373996], [100.1780292791725, 0.0003397132642480673], [100.1253404347878, 0.00037763148771213594], [100.07043384571357, 0.0004155904803999226], [100.01330527389936, 0.00045359199449736525], [99.95395029764664, 0.0004916377941315825], [99.89236430502932, 0.0005297296559196472], [99.8285424919033, 0.0005678693695194117], [99.76247986958019, 0.0006060587381974278], [99.69417126276024, 0.0006442995793848689], [99.6236112976988, 0.0006825937252662457], [99.5507943998404, 0.0007209430233719122], [99.475714801338, 0.0007593493371898845], [99.3983665336116, 0.0007978145467670342], [99.31874341987533, 0.0008363405493536284], [99.23683908748866, 0.0008749292600382255], [99.152646950105, 0.000913582612396281], [99.06616020479144, 0.0009523025591769668], [98.97737183918096, 0.0009910910729815957], [98.88627462852078, 0.001029950146965777], [98.79286112204919, 0.0010688817955499242], [98.69712364494038, 0.0011078880551716182], [98.59905430000963, 0.0011469709850230837], [98.49864495363931, 0.0011861326678322473], [98.39588723729656, 0.0012253752106551438], [98.29077253820753, 0.0012647007456887628], [98.18329200076191, 0.0013041114311139776], [98.07343653339355, 0.001343609451943312], [97.96119678774689, 0.0013831970208914915], [97.8465631542015, 0.0014228763792970421], [97.72952576838185, 0.0014626497980422223], [97.61007450658303, 0.0015025195785081313], [97.4881989751014, 0.0015424880535477082], [97.36388849341705, 0.0015825575885060005], [97.23713210040617, 0.0016227305822706522], [97.10791855472122, 0.001663009468334173], [96.97623632323652, 0.0017033967158981036], [96.84207357512003, 0.001743894831010943], [96.70541817568966, 0.001784506357741303], [96.56625768004633, 0.001825233879387821], [96.42457933284446, 0.0018660800197274308], [96.28037005517272, 0.001907047444292836], [96.13361643108409, 0.0019481388617131781], [95.9843047065397, 0.0019893570250877845], [95.83242077509338, 0.0020307047334055077], [95.6779501833587, 0.0020721848330232952], [95.5208781228408, 0.0021138002191598173], [95.36118940106759, 0.0021555538374756875], [95.19886844631237, 0.0021974486857088095], [95.03389930541633, 0.002239487815342426], [94.8662656274171, 0.002281674333344534], [94.69595066107237, 0.002324011403969493], [94.5229372298561, 0.0023665022506114903], [94.3472077289282, 0.0024091501577657476], [94.16874412137983, 0.0024519584730078045], [93.98752791178394, 0.002494930609087809], [93.80354013379736, 0.0025380700460897344], [93.61676135366419, 0.0025813803336874022], [93.42717164915844, 0.0026248650934425693], [93.23475059667255, 0.002668528021252471], [93.03947725678645, 0.0027123728898315064], [92.8413301516347, 0.00275640355135425], [92.64028727537442, 0.0028006239401559417], [92.43632605253111, 0.0028450380755412137], [92.2294233215883, 0.002889650064758521], [92.01955533559365, 0.0029344641060453157], [91.80669774508132, 0.0029794844918172316], [91.59082556063491, 0.0030247156119724574], [91.37191313352854, 0.0030701619573929736], [91.14993415459793, 0.0031158281235385706], [90.92486163402123, 0.0031617188142156775], [90.69666785891144, 0.0032078388454900683], [90.46532437035275, 0.0032541931498355774], [90.23080196005337, 0.0033007867804041016], [89.99307063509652, 0.0033476249155095657], [89.75209959181925, 0.0033947128633160795], [89.5078571884935, 0.0034420560667418245], [89.26031091674184, 0.0034896601085909525], [89.00942738384705, 0.0035375307169266124], [88.75517225701198, 0.003585673770672571], [88.49751023042691, 0.0036340953055640523], [88.23640501536984, 0.0036828015203060373], [87.97181930536807, 0.0037317987830608862], [87.70371471144665, 0.003781093638227217], [87.43205172226008, 0.003830692813650316], [87.1567896893649, 0.003880603228105141], [86.87788676987938, 0.003930831999194], [86.59529988036624, 0.003981386451653452], [86.30898464831883, 0.004032274126096544], [86.01889536109726, 0.004083502788218499], [85.72498491214898, 0.004135080438496072], [85.42720474433607, 0.00418701532241318], [85.12550479017679, 0.0042393159412479385], [84.81983340879404, 0.004291991063459028], [84.5101373193467, 0.004345049736712364], [84.19636153070088, 0.004398501300592373], [83.87844926707903, 0.004452355400045812], [83.55634188940185, 0.004506621999610074], [83.22997881201452, 0.004561311398482287], [82.89929741446176, 0.004616434246490345], [82.56423294794703, 0.004672001561032271], [82.2247184360793, 0.004728024745056172], [81.88068456947452, 0.004784515606159418], [81.53205959374064, 0.004841486376892812], [81.17876919033033, 0.004898949736363291], [80.82073634969858, 0.004956918833237406], [80.45788123614786, 0.0050154073102573965], [80.09012104368475, 0.005074429330392322], [79.71736984214569, 0.00513399960475857], [79.33953841277558, 0.005194133422457183], [78.95653407236114, 0.0052548466824901665], [78.56826048492819, 0.005316155927934275], [78.17461745991022, 0.005378078382569123], [77.7755007355784, 0.005440631990176943], [77.37080174664592, 0.005503835456754142], [76.96040737330584, 0.005567708295901458], [76.54419967256018, 0.005632270877687646], [76.12205558749696, 0.0056975444813144125], [75.69384663371868, 0.005763551351948493], [75.25943856038275, 0.005830314762127943], [74.81869098329216, 0.005897859078197659], [74.37145698716236, 0.005966209832283371], [73.91758269383465, 0.0060353938003751715], [73.45690679279815, 0.006105439087162325], [72.98926002991354, 0.006176375218341955], [72.51446464969189, 0.00624823324121713], [72.03233378585873, 0.006321045834506729], [71.5426707942106, 0.006394847428412873], [71.04526852093367, 0.006469674336134462], [70.53990849857578, 0.006545564898181099], [70.02636006072184, 0.0066225596410345675], [69.50437936508288, 0.006700701451930337], [68.97370831313289, 0.006780035771795523], [68.43407335256646, 0.00686061080869001], [67.8851841466434, 0.006942477774463581], [67.32673209186049, 0.007025691147775421], [66.75838866225183, 0.00711030896713783], [66.17980355485177, 0.0071963931582612346], [65.59060260631186, 0.007284009900715265], [64.99038544515933, 0.0073732300398089996], [64.37872283748214, 0.00746412955066839], [63.7551536756205, 0.007556790062796035], [63.11918155248295, 0.007651299454991811], [62.4702708327936, 0.0077477525324955235], [61.807842163898016, 0.00784625180062039], [61.131267286757335, 0.007946908352166687], [60.439863029792036, 0.008049842889715565], [59.73288431809853, 0.00815518690866071], [59.00951599328647, 0.008263084072910782], [58.26886318690553, 0.008373691822973426], [57.509939922129064, 0.008487183266183003], [56.731655528237035, 0.008603749411944013], [55.93279833223972, 0.008723601832131729], [55.1120159298108, 0.008846975849786139], [54.267791116138504, 0.008974134390210388], [53.398412250458435, 0.009105372670840365], [52.50193639670235, 0.009241023964694867], [51.57614296640321, 0.009381466754275375], [50.6184746934428, 0.009527133709932164], [49.625961439718274, 0.009678523097050378], [48.595120311980885, 0.00983621346919261], [47.5218224296749, 0.010000882888138326], [46.40111165913408, 0.010173334509700269], [45.226952552434774, 0.010354531332544641], [43.991869172112445, 0.01054564450191485], [42.686414808424615, 0.010748122299653915], [41.298358206368796, 0.010963791913276693], [39.81138322426492, 0.01119501553915146], [38.202887604466426, 0.01144494166140251], [36.43998002633635, 0.011717935151111612], [34.47146824927844, 0.012020375653419475], [32.209497231541505, 0.012362317184718568], [29.47765238412222, 0.01276158503658082], [25.795166179051495, 0.013257530601938934], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0]], "velocities": [], "times": [0.0, 3.131182216252226e-22, 6.2626292052599e-22, 9.39435826671517e-22, 1.2526386768170578e-21, 1.5658732149389876e-21, 1.8791411926820126e-21, 2.192444369789823e-21, 2.5057845145703066e-21, 2.8191634043447798e-21, 3.132582825910668e-21, 3.446044576010718e-21, 3.7595504618090895e-21, 4.07310230136717e-21, 4.386701924141997e-21, 4.700351171485227e-21, 5.0140518971581825e-21, 5.3278059678327415e-21, 5.6416152636244195e-21, 5.9554816786274735e-21, 6.2694071214680374e-21, 6.5833935158441874e-21, 6.897442801108722e-21, 7.211556932839688e-21, 7.525737883422775e-21, 7.839987642670727e-21, 8.15430821843154e-21, 8.468701637218494e-21, 8.783169944846048e-21, 9.097715207106041e-21, 9.412339510425496e-21, 9.727044962566257e-21, 1.0041833693333028e-20, 1.0356707855299074e-20, 1.0671669624559336e-20, 1.0986721201484836e-20, 1.1301864811496707e-20, 1.1617102705888699e-20, 1.1932437162643785e-20, 1.2247870487282611e-20, 1.256340501372579e-20, 1.2879043105200011e-20, 1.3194787155170246e-20, 1.3510639588278929e-20, 1.3826602861322785e-20, 1.414267946425871e-20, 1.4458871921239987e-20, 1.4775182791684074e-20, 1.5091614671373436e-20, 1.5408170193579706e-20, 1.5724852030245633e-20, 1.6041662893193723e-20, 1.6358605535374075e-20, 1.667568275216488e-20, 1.6992897382680374e-20, 1.7310252311158644e-20, 1.7627750468396777e-20, 1.79453948332103e-20, 1.8263188433955718e-20, 1.8581134350106408e-20, 1.889923571387092e-20, 1.9217495711909753e-20, 1.953591758705943e-20, 1.9854504640161323e-20, 2.017326023194403e-20, 2.04921877849909e-20, 2.081129078573694e-20, 2.1130572786602658e-20, 2.1450037408148053e-20, 2.1769688341373925e-20, 2.208952935006545e-20, 2.2409564273228246e-20, 2.2729797027673623e-20, 2.3050231610657002e-20, 2.3370872102642045e-20, 2.3691722670160668e-20, 2.4012787568849446e-20, 2.433407114655747e-20, 2.4655577846606393e-20, 2.4977312211170764e-20, 2.529927888486878e-20, 2.5621482618448315e-20, 2.594392827265886e-20, 2.62666208222982e-20, 2.658956536044369e-20, 2.6912767102878716e-20, 2.723623139272553e-20, 2.7559963705270456e-20, 2.788396965309819e-20, 2.8208254991393693e-20, 2.85328256235296e-20, 2.8857687606899425e-20, 2.9182847159131703e-20, 2.9508310664526805e-20, 2.983408468085305e-20, 3.0160175946493874e-20, 3.048659138796859e-20, 3.081333812785113e-20, 3.1140423493112725e-20, 3.146785502391691e-20, 3.179564048289719e-20, 3.212378786495033e-20, 3.24523054075807e-20, 3.278120160183437e-20, 3.3110485203864463e-20, 3.3440165247173154e-20, 3.377025105557932e-20, 3.4100752256965237e-20, 3.443167879786044e-20, 3.4763040958925895e-20, 3.509484937140748e-20, 3.5427115034634105e-20, 3.575984933464263e-20, 3.609306406401973e-20, 3.6426771443059275e-20, 3.676098414234352e-20, 3.7095715306866934e-20, 3.7430978581833584e-20, 3.776678814027207e-20, 3.810315871262707e-20, 3.8440105618503124e-20, 3.8777644800755165e-20, 3.9115792862140904e-20, 3.9454567104775144e-20, 3.979398557265151e-20, 4.013406709752781e-20, 4.0474831348506396e-20, 4.0816298885679433e-20, 4.1158491218253536e-20, 4.150143086761936e-20, 4.1845141435889764e-20, 4.2189647680496856e-20, 4.2534975595515343e-20, 4.288115250046777e-20, 4.3228207137469775e-20, 4.3576169777692204e-20, 4.392507233825481e-20, 4.42749485108274e-20, 4.462583390340278e-20, 4.4977766196926905e-20, 4.533078531873271e-20, 4.568493363503226e-20, 4.6040256165088205e-20, 4.639680082012199e-20, 4.675461867053877e-20, 4.711376424567741e-20, 4.74742958710528e-20, 4.783627604897911e-20, 4.8199771889586826e-20, 4.8564855600625295e-20, 4.893160504614009e-20, 4.9300104386242667e-20, 4.967044481280936e-20, 5.00427253992632e-20, 5.041705408681944e-20, 5.079354883492706e-20, 5.117233897055434e-20, 5.155356677994184e-20, 5.19373893982139e-20, 5.232398106782459e-20, 5.2713535857683103e-20, 5.310627096308033e-20, 5.350243074534943e-20, 5.390229172421428e-20, 5.430616881213203e-20, 5.47144231896825e-20, 5.512747238175891e-20, 5.554580333452496e-20, 5.596998966050725e-20, 5.640071479583048e-20, 5.683880374546486e-20, 5.728526764848908e-20, 5.774136810196293e-20, 5.820871308636179e-20, 5.86894057421585e-20, 5.91862864525902e-20, 5.970335110859921e-20, 6.024653205519104e-20, 6.082531696949156e-20, 6.145664881251142e-20, 6.217686760316549e-20, 6.310101695047285e-20, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], "losses": []}, "proton": {"positions": [[100.55304172951233, 0.0], [100.55195277198374, 2.5055785784848075e-05], [100.54868581731887, 5.011265701322415e-05], [100.54324061924792, 7.517169942210261e-05], [100.53561676721455, 0.00010023399933555391], [100.52581369076991, 0.00012530064395880136], [100.51383065024166, 0.00015037272166834527], [100.49966673644452, 0.00017545132231652983], [100.48332088400217, 0.00020053753752350822], [100.4647918572414, 0.00022563246097041448], [100.44407825428759, 0.0002507371887076587], [100.42117850649089, 0.0002758528194466086], [100.39609087324068, 0.00030098045487143333], [100.36881345044507, 0.00032612119993929067], [100.33934416520025, 0.00035127616318738746], [100.30768077960012, 0.00037644645704255756], [100.27382088059495, 0.0004016331981289326], [100.23776187903027, 0.00042683750759252325], [100.19950101787698, 0.00045206051141507365], [100.1590353665035, 0.00047730334073599795], [100.11636182420038, 0.0005025671321779981], [100.07147710954331, 0.0005278530281718636], [100.02437776379739, 0.0005531621772996784], [99.9750601542064, 0.0005784957346234571], [99.92352046308898, 0.0006038548620327668], [99.86975468620946, 0.0006292407285925633], [99.81375864071568, 0.0006546545109011551], [99.75552796342859, 0.0006800973934390909], [99.69505809946261, 0.0007055705689384702], [99.63234430512709, 0.0007310752387535214], [99.56738164104894, 0.0007566126132376198], [99.50016497498184, 0.0007821839121321041], [99.43068898455702, 0.000807790364952159], [99.35894815015607, 0.0008334332113851092], [99.28493675758038, 0.0008591137016964914], [99.20864888558427, 0.000884833097139064], [99.1300784033205, 0.0009105926703859056], [99.04921898283477, 0.0009363937059568652], [98.96606408108366, 0.0009622375006541536], [98.88060693705935, 0.0009881253640236338], [98.79284057903703, 0.0010140586188103048], [98.70275781637297, 0.001040038601429691], [98.61035123629311, 0.0010660666624502876], [98.51561320055905, 0.0010921441670875456], [98.41853584738253, 0.001118272495709894], [98.31911108251087, 0.001144453044351595], [98.21733057012192, 0.0011706872252500446], [98.1131857287841, 0.0011969764673911024], [98.00666773846112, 0.0012233222170745907], [97.89776753076659, 0.0012497259384769157], [97.78647577917774, 0.0012761891142529368], [97.67278290569385, 0.0013027132461360823], [97.55667907641684, 0.0013292998555612578], [97.4381541852338, 0.0013559504842990061], [97.31719784882758, 0.0013826666951268492], [97.19379941900515, 0.0014094500725008985], [97.06794796572595, 0.001436302223247069], [96.93963225955574, 0.0014632247772860577], [96.80884077780077, 0.0014902193883803247], [96.67556170463897, 0.0015172877348903103], [96.53978291895855, 0.0015444315205608507], [96.40149198797388, 0.0015716524753322063], [96.26067616060777, 0.001598952356176779], [96.11732236063133, 0.0016263329479626462], [95.97141717955168, 0.0016537960643450938], [95.82294687589558, 0.0016813435486873899], [95.6718973542618, 0.0017089772750044038], [95.51825415736195, 0.0017366991489611303], [95.36200247112384, 0.0017645111088816316], [95.20312711651596, 0.001792415126800446], [95.04161252667969, 0.0018204132095421583], [94.87744273770879, 0.0018485073998637772], [94.71060140047624, 0.0018766997776123377], [94.54107174912173, 0.0019049924609236182], [94.3688365906918, 0.0019333876074906684], [94.19387831680791, 0.001961887415851944], [94.01617886997457, 0.001990494126726622], [93.83571973201985, 0.0020192100244278365], [93.65248193545278, 0.002048037438300715], [93.46644602736933, 0.00207697874421473], [93.27759205647133, 0.0021060363661433955], [93.08589957566168, 0.002135212777774968], [92.89134762003613, 0.00216451050419646], [92.69391469232144, 0.0021939321236443075], [92.49357874771935, 0.0022234802693250357], [92.29031717812717, 0.0022531576313094418], [92.08410679570473, 0.0022829669585040404], [91.8749238251237, 0.0023129110607037263], [91.66274386702334, 0.0023429928107175494], [91.44754187935173, 0.0023732151466210665], [91.22929217674053, 0.0024035810740667446], [91.00796840090827, 0.002434093668706091], [90.78354349955171, 0.002464756078716707], [90.55598970431123, 0.0024955715274399244], [90.32527850776013, 0.0025265433161350487], [90.09138063936655, 0.002557674826856612], [89.85426604037102, 0.002588969525461459], [89.61390384901732, 0.0026204309647529264], [89.37026235013646, 0.0026520627877535882], [89.12330894630793, 0.002683868731179643], [88.87301015080381, 0.002715852629028961], [88.61933154457698, 0.002748018416356478], [88.36223774323966, 0.002780370133230996], [88.10169236244785, 0.0028129119288841475], [87.83765798159784, 0.002845648066063059], [87.57009611964934, 0.002878582925599045], [87.29896716737161, 0.002911721011184423], [87.02423034520899, 0.0029450669544557316], [86.74584368703347, 0.002978625520273053], [86.46376397981523, 0.0030124016122950866], [86.17794671479253, 0.0030464002788467997], [85.8883460360707, 0.0030806267190985736], [85.594914686483, 0.00311508628957721], [85.29760395053358, 0.00314978451103073], [84.99636359422874, 0.0031847270756706334], [84.69114180158643, 0.0032199198548171523], [84.38188510759781, 0.0032553689069750977], [84.06853832739573, 0.003291080486370137], [83.7510444813646, 0.0033270610519777997], [83.42934471590421, 0.0033633172770802062], [83.1033782195352, 0.0033998560593884635], [82.77308213400714, 0.0034366845317719283], [82.43839146004055, 0.003473810073639102], [82.09923895730147, 0.003511240323018856], [81.7555550381712, 0.003548983189395019], [81.40726765483399, 0.0035870468673521476], [81.05430217916135, 0.003625439851095578], [80.69658127496874, 0.0036641709499146543], [80.33402476129088, 0.0037032493046647748], [79.96654946744877, 0.003742684405350767], [79.59406907770001, 0.0037824861099020803], [79.21649396537366, 0.003822664664239554], [78.8337310154343, 0.0038632307237431436], [78.44568343447182, 0.003904195376241165], [78.052250547009, 0.00394557016665398], [77.65332757690126, 0.003987367123438953], [77.24880541247131, 0.004029598786999056], [76.83857035387246, 0.004072278240235045], [76.42250384100619, 0.004115419141440806], [76.00048216013076, 0.0041590357597637495], [75.57237612708086, 0.004203143013477277], [75.13805074477597, 0.0042477565113408205], [74.6973648324152, 0.004292892597355315], [74.25017062344057, 0.00433856839925876], [73.7963133289871, 0.004384801881148466], [73.33563066312315, 0.004431611900664535], [72.86795232570606, 0.00447901827122406], [72.39309943812829, 0.004527041829858578], [71.9108839265931, 0.004575704511279972], [71.42110784682247, 0.004625029428883852], [70.92356264324373, 0.004675040963496513], [70.41802833470335, 0.004725764860784313], [69.90427261759069, 0.004777228338375567], [69.38204987588426, 0.004829460203898417], [68.85110008602292, 0.004882490985317944], [68.31114760259953, 0.004936353075167183], [67.76189980861632, 0.004991080890516345], [67.20304561135175, 0.005046711050820227], [66.63425376167241, 0.005103282576135622], [66.05517097076087, 0.005160837108620629], [65.46541979356968, 0.005219419160731866], [64.86459624266061, 0.005279076394142886], [64.25226708920266, 0.005339859934142567], [63.62796679946531, 0.005401824725167159], [62.99119404474921, 0.005465029934214576], [62.341407709811925, 0.005529539410236523], [61.67802231292993, 0.005595422209266736], [61.00040270567941, 0.005662753197136993], [60.307857957049194, 0.00573161374421543], [59.599634211384, 0.005802092529886543], [58.874906329674516, 0.005874286478697544], [58.13276804484144, 0.005948301855442745], [57.37222029489106, 0.006024255553403105], [56.59215730415582, 0.006102276619023116], [55.791349857724704, 0.006182508068265653], [54.96842504509082, 0.006265109065832536], [54.121841517634905, 0.006350257559956221], [53.249858983446465, 0.006438153494875082], [52.35050021061962, 0.006529022763857927], [51.421503203880086, 0.006623122122914308], [50.46026007908951, 0.006720745367575946], [49.46373812391839, 0.006822231194698275], [48.42837603964895, 0.006927973349147808], [47.34994506353439, 0.007038433926988732], [46.223359993036546, 0.007154161129928893], [45.042414185846745, 0.007275813451101698], [43.79940102864531, 0.007404193409949644], [42.48455146106088, 0.007540295932527201], [41.085169970593554, 0.00768538007174342], [39.58424202675739, 0.007841079677565158], [37.95805644295631, 0.008009582890780806], [36.17183154397354, 0.008193942386948951], [34.170821638474585, 0.00839865895850829], [31.85945505438924, 0.008630918137600575], [29.040051200326054, 0.008903739685172189], [25.13593742387431, 0.009247258480253652], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0], [0.0, 0.0]], "velocities": [], "times": [0.0, 3.1283236090645917e-22, 6.256664158390579e-22, 9.385038592268632e-22, 1.2513463863050626e-21, 1.564195693518688e-21, 1.8770534789200463e-21, 2.1899214425884796e-21, 2.502801287030198e-21, 2.8156947175796836e-21, 3.1286034428243196e-21, 3.4415291750026805e-21, 3.754473630433796e-21, 4.067438529927704e-21, 4.380425599206132e-21, 4.6934365693264624e-21, 5.0064731771020334e-21, 5.3195371655480284e-21, 5.6326302843098404e-21, 5.945754290103138e-21, 6.258910947158744e-21, 6.572102027665235e-21, 6.885329312239142e-21, 7.19859459037133e-21, 7.511899660901742e-21, 7.825246332493215e-21, 8.138636424119703e-21, 8.452071765538988e-21, 8.765554197795668e-21, 9.079085573724577e-21, 9.392667758462547e-21, 9.706302629976826e-21, 1.0019992079587104e-20, 1.0333738012504968e-20, 1.0647542348383452e-20, 1.0961407021869098e-20, 1.1275333983189237e-20, 1.1589325198726699e-20, 1.1903382651606377e-20, 1.221750834231915e-20, 1.2531704289334266e-20, 1.2845972529733679e-20, 1.3160315119860761e-20, 1.3474734135983935e-20, 1.3789231674975944e-20, 1.4103809855000542e-20, 1.4418470816233684e-20, 1.4733216721593716e-20, 1.5048049757499126e-20, 1.5362972134618205e-20, 1.5677986088675356e-20, 1.5993093881250717e-20, 1.6308297800610748e-20, 1.6623600162551807e-20, 1.6939003311296437e-20, 1.7254509620385362e-20, 1.757012149359475e-20, 1.78858413659003e-20, 1.8201671704469726e-20, 1.851761500966398e-20, 1.8833673816079032e-20, 1.9149850693619403e-20, 1.9466148248604854e-20, 1.9782569124911634e-20, 2.0099116005149847e-20, 2.0415791611878473e-20, 2.0732598708848047e-20, 2.1049540102319492e-20, 2.1366618642390924e-20, 2.1683837224380954e-20, 2.200119879024633e-20, 2.2318706330086144e-20, 2.263636288365991e-20, 2.2954171541958397e-20, 2.3272135448870328e-20, 2.3590257802868216e-20, 2.390854185875477e-20, 2.4226990929515822e-20, 2.454560838819874e-20, 2.4864397669860566e-20, 2.5183362273635023e-20, 2.550250576483267e-20, 2.582183177713745e-20, 2.614134401488885e-20, 2.646104625545391e-20, 2.678094235169365e-20, 2.7101036234528668e-20, 2.742133191560902e-20, 2.774183349007531e-20, 2.8062545139490083e-20, 2.8383471134835895e-20, 2.870461583965941e-20, 2.9025983713350103e-20, 2.934757931456099e-20, 2.966940730477892e-20, 2.999147245205277e-20, 3.0313779634888344e-20, 3.0636333846319226e-20, 3.095914019813948e-20, 3.128220392540482e-20, 3.1605530391070186e-20, 3.192912509087113e-20, 3.225299365843819e-20, 3.2577141870658224e-20, 3.2901575653297425e-20, 3.322630108690212e-20, 3.355132441296331e-20, 3.3876652040486654e-20, 3.420229055280346e-20, 3.452824671476606e-20, 3.4854527480319895e-20, 3.5181140000476855e-20, 3.5508091631716203e-20, 3.583538994484174e-20, 3.616304273432576e-20, 3.649105802817319e-20, 3.681944409834181e-20, 3.7148209471757396e-20, 3.7477362941966054e-20, 3.780691358146938e-20, 3.8136870754792146e-20, 3.84672441323365e-20, 3.8798043705081333e-20, 3.9129279800190864e-20, 3.946096309760217e-20, 3.9793104647667834e-20, 4.0125715889937013e-20, 4.045880867316587e-20, 4.0792395276657694e-20, 4.112648843304197e-20, 4.146110135261272e-20, 4.179624774935887e-20, 4.213194186883259e-20, 4.24681985180167e-20, 4.280503309736919e-20, 4.314246163524209e-20, 4.3480500824892976e-20, 4.381916806433209e-20, 4.4158481499274727e-20, 4.449846006949999e-20, 4.4839123558951606e-20, 4.5180492649956613e-20, 4.55225889819829e-20, 4.5865435215408466e-20, 4.6209055100834625e-20, 4.6553473554543184e-20, 4.68987167407762e-20, 4.7244812161606973e-20, 4.7591788755275304e-20, 4.79396770039815e-20, 4.828850905227408e-20, 4.863831883733091e-20, 4.8989142232626026e-20, 4.9341017206700366e-20, 4.969398399902179e-20, 5.0048085315235016e-20, 5.040336654447721e-20, 5.0759876001882196e-20, 5.111766519993193e-20, 5.1476789152958226e-20, 5.183730671987699e-20, 5.219928099118351e-20, 5.256277972739266e-20, 5.292787585752681e-20, 5.3294648048005845e-20, 5.366318135447e-20, 5.403356797178176e-20, 5.440590810090245e-20, 5.478031095565728e-20, 5.5156895937954e-20, 5.553579401720975e-20, 5.591714935902588e-20, 5.630112126037676e-20, 5.66878864647874e-20, 5.707764195271312e-20, 5.747060833184017e-20, 5.786703399259863e-20, 5.826720025076686e-20, 5.867142777920527e-20, 5.908008474615263e-20, 5.949359724735408e-20, 5.991246287343794e-20, 6.033726864392747e-20, 6.076871515466113e-20, 6.120764978160158e-20, 6.165511346186696e-20, 6.211240849585316e-20, 6.258120016544276e-20, 6.306367529581839e-20, 6.356280218555144e-20, 6.40827839886729e-20, 6.462991588519247e-20, 6.521439312125746e-20, 6.585478203972812e-20, 6.659234715075466e-20, 6.757103323449213e-20, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], "losses": []}}}};
        const blackHoleMass = 99450000000000.0;
        
        // Constants
        const G = 6.67430e-11;
        const c = 299792458;
        const M_physical = G * blackHoleMass / (c * c); // Geometric units in meters
        const M = 1.0; // Use normalized units for visualization
        
        // Three.js setup
        let scene, camera, renderer, controls;
        let blackHole, particles = {};
        let trajectoryLines = {};
        let currentPositions = {};
        let animationTime = 0;
        let isPlaying = true;
        let animationSpeed = 1.0;
        let currentView = 'third';
        let primaryParticle = 'electron';
        let mountedParticle = null;
        let currentTheory = null;
        let overlayTheory = null;
        let overlayTrajectories = {};
        let overlayParticles = {};
        let spacetimeGrid = null;
        let raycaster, mouse;
        let hoveredObject = null;
        let selectedObject = null;
        
        // Particle colors
        const particleColors = {
            electron: 0x3498db,
            neutrino: 0xe74c3c,
            photon: 0xf39c12,
            proton: 0x2ecc71
        };
        
        function init() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000814);
            
            // Camera setup
            camera = new THREE.PerspectiveCamera(
                75, 
                window.innerWidth / window.innerHeight,
                0.1,
                5000  // Increased far plane to prevent clipping
            );
            
            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Controls - always orbit around the black hole
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 5;
            controls.maxDistance = 1000;  // Increased max distance
            controls.target.set(0, 0, 0); // Always focus on black hole
            controls.enablePan = false; // Disable panning to keep focus on black hole
            
            // Raycaster for mouse interactions
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 2);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(50, 50, 50);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // Add point light for better black hole visibility
            const pointLight = new THREE.PointLight(0xffffff, 1, 100);
            pointLight.position.set(10, 10, 10);
            scene.add(pointLight);
            
            // Create black hole
            createBlackHole();
            
            // Create spacetime grid
            createSpacetimeGrid();
            
            // Add observer reference frame indicator
            const observerGeometry = new THREE.ConeGeometry(2, 5, 4);
            const observerMaterial = new THREE.MeshBasicMaterial({
                color: 0x00ff00,
                transparent: true,
                opacity: 0.5
            });
            const observerIndicator = new THREE.Mesh(observerGeometry, observerMaterial);
            observerIndicator.name = 'observerIndicator';
            scene.add(observerIndicator);
            
            // Add axes helper for orientation at proper scale
            const axesHelper = new THREE.AxesHelper(50);
            scene.add(axesHelper);
            
            // Setup UI
            populateTheorySelector();
            
            // Event listeners
            window.addEventListener('resize', onWindowResize);
            document.getElementById('speedSlider').addEventListener('input', updateSpeed);
            document.getElementById('timeSlider').addEventListener('input', updateTimeFromSlider);
            document.getElementById('theorySelect').addEventListener('change', onTheoryChange);
            document.getElementById('overlaySelect').addEventListener('change', onOverlayChange);
            
            // Mouse events
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('click', onMouseClick);
            
            // Update Schwarzschild radius display
            document.getElementById('schwarzschildRadius').textContent = (2 * M).toFixed(3) + ' (scaled)';
            
            // Set initial camera position to top-down view
            setView('top');
            
            // Load Kerr-Newman as default if available, otherwise first theory
            const kerrNewmanOption = document.getElementById('theorySelect').querySelector('option[value="Kerr-Newman"]');
            const firstTheory = document.getElementById('theorySelect').querySelector('option:not([value=""])');
            const defaultTheory = kerrNewmanOption || firstTheory;
            
            if (defaultTheory) {
                document.getElementById('theorySelect').value = defaultTheory.value;
                loadTheory(defaultTheory.value);
            }
            
            // Start animation
            animate();
        }
        
        function createBlackHole() {
            // Create realistic black hole with event horizon
            // Scale up for visibility
            const bhRadius = 2 * M; // Event horizon at 2M
            const geometry = new THREE.SphereGeometry(bhRadius, 64, 64);
            const material = new THREE.MeshPhysicalMaterial({
                color: 0x000000,
                metalness: 1,
                roughness: 0,
                opacity: 0.95,
                transparent: true
            });
            
            blackHole = new THREE.Mesh(geometry, material);
            blackHole.name = 'Black Hole';
            blackHole.userData = {
                type: 'blackhole',
                mass: blackHoleMass,
                schwarzschildRadius: 2 * M
            };
            blackHole.position.set(0, 0, 0);
            scene.add(blackHole);
            
            // Add glow effect around black hole
            const glowGeometry = new THREE.SphereGeometry(bhRadius * 1.2, 32, 32);
            const glowMaterial = new THREE.MeshBasicMaterial({
                color: 0xff4400,
                transparent: true,
                opacity: 0.1,
                side: THREE.BackSide
            });
            const glow = new THREE.Mesh(glowGeometry, glowMaterial);
            blackHole.add(glow);
            
            // Add thin accretion disk hint
            const diskGeometry = new THREE.RingGeometry(2.5 * M, 4 * M, 64);
            const diskMaterial = new THREE.MeshBasicMaterial({
                color: 0xff6600,
                side: THREE.DoubleSide,
                opacity: 0.3,
                transparent: true
            });
            const disk = new THREE.Mesh(diskGeometry, diskMaterial);
            disk.rotation.x = Math.PI / 2;
            disk.name = 'Accretion Disk';
            blackHole.add(disk);
            
            // Add photon sphere indicator
            const photonSphereGeometry = new THREE.RingGeometry(3 * M - 0.05, 3 * M + 0.05, 64);
            const photonSphereMaterial = new THREE.MeshBasicMaterial({
                color: 0xffff00,
                side: THREE.DoubleSide,
                opacity: 0.3,
                transparent: true
            });
            const photonSphere = new THREE.Mesh(photonSphereGeometry, photonSphereMaterial);
            photonSphere.rotation.x = Math.PI / 2;
            photonSphere.name = 'Photon Sphere';
            blackHole.add(photonSphere);
        }
        
        function createSpacetimeGrid() {
            // Create spacetime grid showing Schwarzschild metric curvature
            spacetimeGrid = new THREE.Group();
            spacetimeGrid.name = 'Spacetime Grid';
            
            // Grid parameters - denser near black hole for better curvature visualization
            const innerRadius = 2.5;  // Just outside event horizon
            const outerRadius = 150;
            const radialLines = 24;   // Number of radial lines
            const circularLines = 40; // Number of circular lines
            
            // Create radial lines (like spokes of a wheel)
            for (let i = 0; i < radialLines; i++) {
                const angle = (i / radialLines) * Math.PI * 2;
                const points = [];
                
                // Sample more densely near the black hole
                for (let r = innerRadius; r <= outerRadius; r *= 1.08) {
                    // Calculate embedding height using Flamm's paraboloid
                    // z = 2*sqrt(2M(r-2M)) for the Schwarzschild metric
                    const height = r > 2 ? -2 * Math.sqrt(2 * M * (r - 2 * M)) : 0;
                    
                    points.push(new THREE.Vector3(
                        r * Math.cos(angle),
                        height * 2,  // Scale up for visibility
                        r * Math.sin(angle)
                    ));
                }
                
                const geometry = new THREE.BufferGeometry().setFromPoints(points);
                const material = new THREE.LineBasicMaterial({
                    color: 0x00ff00,
                    transparent: true,
                    opacity: 0.6
                });
                const line = new THREE.Line(geometry, material);
                spacetimeGrid.add(line);
            }
            
            // Create circular lines (concentric circles at different radii)
            for (let i = 0; i < circularLines; i++) {
                // Logarithmic spacing for circles - denser near black hole
                const t = i / (circularLines - 1);
                const r = innerRadius * Math.pow(outerRadius / innerRadius, t);
                
                const points = [];
                const segments = 64;
                
                // Calculate embedding height for this radius
                const height = r > 2 ? -2 * Math.sqrt(2 * M * (r - 2 * M)) : 0;
                
                for (let j = 0; j <= segments; j++) {
                    const angle = (j / segments) * Math.PI * 2;
                    points.push(new THREE.Vector3(
                        r * Math.cos(angle),
                        height * 2,  // Scale up for visibility
                        r * Math.sin(angle)
                    ));
                }
                
                const geometry = new THREE.BufferGeometry().setFromPoints(points);
                const material = new THREE.LineBasicMaterial({
                    color: 0x00ff00,
                    transparent: true,
                    opacity: 0.6
                });
                const line = new THREE.Line(geometry, material);
                spacetimeGrid.add(line);
            }
            
            // Add special radius indicators with strong colors
            const keyRadii = [
                { r: 2, name: 'Event Horizon', color: 0xff0000, linewidth: 3 },
                { r: 3, name: 'Photon Sphere', color: 0xffaa00, linewidth: 2 },
                { r: 6, name: 'ISCO', color: 0xffff00, linewidth: 2 }
            ];
            
            keyRadii.forEach(({r, name, color, linewidth}) => {
                const points = [];
                const segments = 128;
                const height = r > 2 ? -2 * Math.sqrt(2 * M * (r - 2 * M)) : 0;
                
                for (let i = 0; i <= segments; i++) {
                    const angle = (i / segments) * Math.PI * 2;
                    points.push(new THREE.Vector3(
                        r * Math.cos(angle),
                        height * 2,
                        r * Math.sin(angle)
                    ));
                }
                
                const geometry = new THREE.BufferGeometry().setFromPoints(points);
                const material = new THREE.LineBasicMaterial({
                    color: color,
                    opacity: 1.0,
                    transparent: false,
                    linewidth: linewidth
                });
                const circle = new THREE.Line(geometry, material);
                circle.name = name;
                spacetimeGrid.add(circle);
            });
            
            // Add coordinate labels
            const labelPositions = [10, 20, 50, 100];
            labelPositions.forEach(r => {
                // Create label showing radius
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = 128;
                canvas.height = 64;
                context.fillStyle = 'white';
                context.font = '32px Arial';
                context.fillText(`${r}M`, 10, 40);
                
                const texture = new THREE.CanvasTexture(canvas);
                const spriteMaterial = new THREE.SpriteMaterial({ 
                    map: texture, 
                    opacity: 0.8,
                    color: 0x00ff00
                });
                const sprite = new THREE.Sprite(spriteMaterial);
                
                // Position label on the grid at angle 0
                const height = r > 2 ? -2 * Math.sqrt(2 * M * (r - 2 * M)) : 0;
                sprite.position.set(r, height * 2 + 5, 0);
                sprite.scale.set(5, 2.5, 1);
                spacetimeGrid.add(sprite);
                
                // Also add label at 90 degrees
                const sprite2 = sprite.clone();
                sprite2.position.set(0, height * 2 + 5, r);
                spacetimeGrid.add(sprite2);
            });
            
            scene.add(spacetimeGrid);
            
            // The grid is now static - shows the intrinsic curvature of spacetime
            // No observer-dependent effects
        }
        
        function updateSpacetimeGrid() {
            // Since the grid is now static and shows intrinsic curvature,
            // we only need to update the spacetime info display
            const cameraPos = camera.position;
            const observerR = cameraPos.length();
            updateSpacetimeInfo(observerR);
        }
        
        function updateSpacetimeInfo(r) {
            const rs = 2 * M;
            const properTimeFactor = Math.sqrt(Math.max(0, 1 - rs / r));
            const spatialCurvature = rs / (2 * r * r);
            
            document.getElementById('cameraDistance').textContent = r.toFixed(2);
            document.getElementById('properTimeFactor').textContent = properTimeFactor.toFixed(4);
            document.getElementById('spatialCurvature').textContent = spatialCurvature.toExponential(2);
            
            // Update description based on distance with scientific details
            let description = '';
            const timeDilationPercent = ((1 - properTimeFactor) * 100).toFixed(1);
            const escapeVelocity = Math.sqrt(2 * rs / r);  // As fraction of c
            
            if (r < 3 * M) {
                description = `DANGER: Near photon sphere (r = 3M)! Time dilation: ${timeDilationPercent}%. ` +
                    `Light can orbit here. Grid shows extreme curvature - Flamm's paraboloid embedding depth maximum.`;
            } else if (r < 6 * M) {
                description = `Strong field regime: Inside ISCO (r = 6M). Time dilation: ${timeDilationPercent}%. ` +
                    `No stable orbits exist. Grid curvature shows deep gravitational well. Escape velocity: ${(escapeVelocity * 100).toFixed(1)}% of c.`;
            } else if (r < 20 * M) {
                description = `Moderate field: Time dilation: ${timeDilationPercent}%. ` +
                    `Grid shows significant curvature - the funnel shape of Flamm's paraboloid is clearly visible.`;
            } else if (r < 50 * M) {
                description = `Weak-moderate field: Time dilation: ${timeDilationPercent}%. ` +
                    `Grid shows gentle spacetime curvature. Radial distances stretched by factor √(1 - rs/r) = ${(1/Math.sqrt(1-rs/r)).toFixed(3)}.`;
            } else {
                description = `Weak field: Nearly flat spacetime. Time dilation: ${timeDilationPercent}%. ` +
                    `Grid approaches Minkowski space. Curvature effects ~ rs/r = ${(rs/r).toFixed(4)}.`;
            }
            
            document.getElementById('spacetimeDescription').innerHTML = description;
        }
        
        function populateTheorySelector() {
            const select = document.getElementById('theorySelect');
            const overlaySelect = document.getElementById('overlaySelect');
            
            // Group theories by category
            const categories = {};
            for (const [theoryName, data] of Object.entries(runData)) {
                const category = data.category || 'other';
                if (!categories[category]) {
                    categories[category] = [];
                }
                categories[category].push(theoryName);
            }
            
            // Add options grouped by category to both selects
            for (const [category, theories] of Object.entries(categories)) {
                const optgroup = document.createElement('optgroup');
                optgroup.label = category.charAt(0).toUpperCase() + category.slice(1);
                
                const overlayOptgroup = document.createElement('optgroup');
                overlayOptgroup.label = category.charAt(0).toUpperCase() + category.slice(1);
                
                theories.sort().forEach(theory => {
                    const option = document.createElement('option');
                    option.value = theory;
                    option.textContent = theory;
                    optgroup.appendChild(option);
                    
                    const overlayOption = document.createElement('option');
                    overlayOption.value = theory;
                    overlayOption.textContent = theory;
                    overlayOptgroup.appendChild(overlayOption);
                });
                
                select.appendChild(optgroup);
                overlaySelect.appendChild(overlayOptgroup);
            }
        }
        
        function onTheoryChange(event) {
            const theoryName = event.target.value;
            if (!theoryName) return;
            
            loadTheory(theoryName);
        }
        
        function onOverlayChange(event) {
            const overlayName = event.target.value;
            
            // Clear existing overlay
            clearOverlay();
            
            if (!overlayName) {
                overlayTheory = null;
                return;
            }
            
            loadOverlay(overlayName);
        }
        
        function loadTheory(theoryName) {
            currentTheory = theoryName;
            const theoryData = runData[theoryName];
            
            if (!theoryData) {
                console.error('Theory data not found:', theoryName);
                return;
            }
            
            // Update display
            document.getElementById('theoryNameDisplay').textContent = theoryName;
            
            // Clear existing particles and trajectories
            clearVisualization();
            
            // Reset animation time
            animationTime = 0;
            document.getElementById('timeSlider').value = 0;
            updateTimeDisplay();
            
            // Load particle data
            const particleData = theoryData.particles || {};
            
            // Create particle controls and visualizations
            createParticleControls(particleData);
            
            // Load trajectories
            console.log('Loading trajectories for', Object.keys(particleData).length, 'particles');
            for (const [particleName, data] of Object.entries(particleData)) {
                if (data && data.positions) {
                    console.log(`Creating visualization for ${particleName} with ${data.positions.length} points`);
                    createParticleVisualization(particleName, data);
                }
            }
            
            // Auto-adjust camera to fit all trajectories
            if (Object.keys(trajectoryLines).length > 0) {
                console.log('Fitting camera to scene with', Object.keys(trajectoryLines).length, 'trajectories');
                fitCameraToScene();
            } else {
                console.log('No trajectories created!');
            }
            
            // Update legend
            updateLegend();
        }
        
        function clearVisualization() {
            // Remove existing particles and trajectories
            for (const name in particles) {
                if (particles[name]) {
                    scene.remove(particles[name]);
                    // Dispose of geometry and materials
                    if (particles[name].geometry) particles[name].geometry.dispose();
                    if (particles[name].material) particles[name].material.dispose();
                }
            }
            for (const name in trajectoryLines) {
                if (trajectoryLines[name]) {
                    scene.remove(trajectoryLines[name]);
                    if (trajectoryLines[name].geometry) trajectoryLines[name].geometry.dispose();
                    if (trajectoryLines[name].material) trajectoryLines[name].material.dispose();
                }
                
                // Also remove the tube geometry
                const tube = scene.getObjectByName(name + '_trajectory_tube');
                if (tube) {
                    scene.remove(tube);
                    if (tube.geometry) tube.geometry.dispose();
                    if (tube.material) tube.material.dispose();
                }
            }
            
            particles = {};
            trajectoryLines = {};
            currentPositions = {};
        }
        
        function clearOverlay() {
            // Remove overlay particles
            for (const name in overlayParticles) {
                if (overlayParticles[name]) {
                    scene.remove(overlayParticles[name]);
                    if (overlayParticles[name].geometry) overlayParticles[name].geometry.dispose();
                    if (overlayParticles[name].material) overlayParticles[name].material.dispose();
                }
            }
            // Remove overlay trajectories
            for (const name in overlayTrajectories) {
                if (overlayTrajectories[name]) {
                    scene.remove(overlayTrajectories[name]);
                    if (overlayTrajectories[name].geometry) overlayTrajectories[name].geometry.dispose();
                    if (overlayTrajectories[name].material) overlayTrajectories[name].material.dispose();
                }
            }
            
            overlayParticles = {};
            overlayTrajectories = {};
            overlayPositions = {};
        }
        
        function loadOverlay(theoryName) {
            overlayTheory = theoryName;
            const theoryData = runData[theoryName];
            
            if (!theoryData) {
                console.error('Overlay theory data not found:', theoryName);
                return;
            }
            
            // Load overlay particle data
            const particleData = theoryData.particles || {};
            
            // Create overlay visualizations
            for (const [particleName, data] of Object.entries(particleData)) {
                if (data && data.positions) {
                    createOverlayVisualization(particleName, data);
                }
            }
        }
        
        function createOverlayVisualization(particleName, data) {
            // Create semi-transparent particle for overlay
            const geometry = new THREE.SphereGeometry(0.8, 16, 16);
            const material = new THREE.MeshPhongMaterial({
                color: particleColors[particleName] || 0xffffff,
                emissive: particleColors[particleName] || 0xffffff,
                emissiveIntensity: 0.3,
                transparent: true,
                opacity: 0.4
            });
            
            const particle = new THREE.Mesh(geometry, material);
            particle.name = `overlay_${particleName}`;
            particle.userData = {
                type: 'overlay_particle',
                name: particleName,
                trajectory: data
            };
            
            overlayParticles[particleName] = particle;
            scene.add(particle);
            
            // Create dashed trajectory line for overlay
            if (data.positions && data.positions.length > 0) {
                const points = [];
                for (let i = 0; i < data.positions.length; i++) {
                    const pos = data.positions[i];
                    const r = pos[0];
                    const phi = pos[1];
                    
                    const x = r * Math.cos(phi);
                    const z = r * Math.sin(phi);
                    
                    // Apply Flamm's paraboloid embedding
                    const height = r > 2 ? -2 * Math.sqrt(2 * M * (r - 2 * M)) : 0;
                    const y = height * 2;
                    
                    points.push(new THREE.Vector3(x, y, z));
                }
                
                const lineGeometry = new THREE.BufferGeometry().setFromPoints(points);
                
                // Use dashed line material for overlay
                const lineMaterial = new THREE.LineDashedMaterial({
                    color: particleColors[particleName] || 0xffffff,
                    opacity: 0.6,
                    transparent: true,
                    dashSize: 3,
                    gapSize: 2,
                    linewidth: 2
                });
                
                const line = new THREE.Line(lineGeometry, lineMaterial);
                line.computeLineDistances();
                line.name = `overlay_trajectory_${particleName}`;
                
                overlayTrajectories[particleName] = line;
                scene.add(line);
                
                // Initialize position
                if (data.positions.length > 0) {
                    const pos = data.positions[0];
                    overlayPositions[particleName] = 0;
                }
            }
        }
        
        function createParticleControls(particleData) {
            const container = document.getElementById('particleControls');
            container.innerHTML = '';
            
            for (const [particleName, data] of Object.entries(particleData)) {
                const control = document.createElement('div');
                control.className = 'particle-control';
                if (particleName === primaryParticle) {
                    control.classList.add('primary');
                }
                
                control.innerHTML = `
                    <div class="particle-name">${particleName.charAt(0).toUpperCase() + particleName.slice(1)}</div>
                    <div class="particle-toggle">
                        <input type="checkbox" id="toggle_${particleName}" checked onchange="toggleParticle('${particleName}')">
                        <label for="toggle_${particleName}">Show</label>
                    </div>
                    <div class="particle-actions">
                        <button class="button small" onclick="makePrimary('${particleName}')">Make Primary</button>
                        <button class="button small" onclick="mountCamera('${particleName}')">Mount Camera</button>
                    </div>
                `;
                
                container.appendChild(control);
            }
        }
        
        function createParticleVisualization(particleName, data) {
            // Create particle scaled for visibility at orbit distances
            const geometry = new THREE.SphereGeometry(1, 16, 16);
            const material = new THREE.MeshPhongMaterial({
                color: particleColors[particleName] || 0xffffff,
                emissive: particleColors[particleName] || 0xffffff,
                emissiveIntensity: 0.5
            });
            
            const particle = new THREE.Mesh(geometry, material);
            particle.name = particleName;
            particle.userData = {
                type: 'particle',
                name: particleName,
                trajectory: data
            };
            
            // Add a glowing effect for better visibility
            const glowGeometry = new THREE.SphereGeometry(2, 16, 16);
            const glowMaterial = new THREE.MeshBasicMaterial({
                color: particleColors[particleName] || 0xffffff,
                transparent: true,
                opacity: 0.3
            });
            const glow = new THREE.Mesh(glowGeometry, glowMaterial);
            particle.add(glow);
            
            particles[particleName] = particle;
            scene.add(particle);
            
            // Create trajectory line following curved spacetime
            if (data.positions && data.positions.length > 0) {
                const points = [];
                console.log(`First position for ${particleName}: r=${data.positions[0][0]}, phi=${data.positions[0][1]}`);
                for (let i = 0; i < data.positions.length; i++) {
                    const pos = data.positions[i];
                    const r = pos[0]; // Already in geometric units from data extraction
                    const phi = pos[1];
                    
                    // Calculate position on curved spacetime surface
                    const x = r * Math.cos(phi);
                    const z = r * Math.sin(phi);
                    
                    // Apply Flamm's paraboloid embedding - same as grid
                    const height = r > 2 ? -2 * Math.sqrt(2 * M * (r - 2 * M)) : 0;
                    const y = height * 2;  // Scale up for visibility, same as grid
                    
                    points.push(new THREE.Vector3(x, y, z));
                }
                console.log(`Created ${points.length} points for ${particleName} trajectory on curved surface`);
                
                const lineGeometry = new THREE.BufferGeometry().setFromPoints(points);
                // Use LineSegments for better visibility
                const lineMaterial = new THREE.LineBasicMaterial({
                    color: particleColors[particleName] || 0xffffff,
                    opacity: 1.0,
                    transparent: false
                });
                
                // Also create a tube geometry for better visibility
                const curve = new THREE.CatmullRomCurve3(points);
                const tubeGeometry = new THREE.TubeGeometry(curve, points.length, 0.3, 8, false);
                const tubeMaterial = new THREE.MeshBasicMaterial({
                    color: particleColors[particleName] || 0xffffff,
                    opacity: 0.6,
                    transparent: true
                });
                
                // Add both line and tube for visibility
                const line = new THREE.Line(lineGeometry, lineMaterial);
                line.name = particleName + '_trajectory';
                trajectoryLines[particleName] = line;
                scene.add(line);
                
                const tube = new THREE.Mesh(tubeGeometry, tubeMaterial);
                tube.name = particleName + '_trajectory_tube';
                scene.add(tube);
            }
            
            // Set initial position
            if (data.positions && data.positions.length > 0) {
                const pos = data.positions[0];
                updateParticlePosition(particleName, pos);
                
                // Add particle name label
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = 256;
                canvas.height = 64;
                context.fillStyle = 'white';
                context.font = '48px Arial';
                context.fillText(particleName, 10, 50);
                
                const texture = new THREE.CanvasTexture(canvas);
                const spriteMaterial = new THREE.SpriteMaterial({ map: texture, opacity: 0.8 });
                const sprite = new THREE.Sprite(spriteMaterial);
                sprite.scale.set(10, 2.5, 1);
                sprite.position.set(0, 5, 0);
                particle.add(sprite);
            }
        }
        
        function updateParticlePosition(particleName, position) {
            const particle = particles[particleName];
            if (!particle) return;
            
            const r = position[0]; // Already in geometric units from data extraction
            const phi = position[1];
            
            // Position particle on curved spacetime surface
            particle.position.x = r * Math.cos(phi);
            particle.position.z = r * Math.sin(phi);
            
            // Apply Flamm's paraboloid embedding - same as trajectory
            const height = r > 2 ? -2 * Math.sqrt(2 * M * (r - 2 * M)) : 0;
            particle.position.y = height * 2;  // Scale up for visibility
            
            currentPositions[particleName] = position;
        }
        
        function updateOverlayParticlePosition(particleName, position) {
            const particle = overlayParticles[particleName];
            if (!particle) return;
            
            const r = position[0];
            const phi = position[1];
            
            // Position particle on curved spacetime surface
            particle.position.x = r * Math.cos(phi);
            particle.position.z = r * Math.sin(phi);
            
            // Apply Flamm's paraboloid embedding
            const height = r > 2 ? -2 * Math.sqrt(2 * M * (r - 2 * M)) : 0;
            particle.position.y = height * 2;
            
            overlayPositions[particleName] = position;
        }
        
        function toggleParticle(particleName) {
            const checkbox = document.getElementById(`toggle_${particleName}`);
            const particle = particles[particleName];
            const trajectory = trajectoryLines[particleName];
            
            if (particle) particle.visible = checkbox.checked;
            if (trajectory) trajectory.visible = checkbox.checked;
            
            // Also toggle the tube if it exists
            const tube = scene.getObjectByName(particleName + '_trajectory_tube');
            if (tube) tube.visible = checkbox.checked;
        }
        
        function makePrimary(particleName) {
            primaryParticle = particleName;
            
            // Update UI
            document.querySelectorAll('.particle-control').forEach(control => {
                control.classList.remove('primary');
            });
            
            const controls = document.getElementById('particleControls').children;
            for (const control of controls) {
                if (control.querySelector('.particle-name').textContent.toLowerCase() === particleName) {
                    control.classList.add('primary');
                    break;
                }
            }
            
            // Update Schwarzschild radius based on particle mass
            updateSchwarzschildRadius(particleName);
        }
        
        function updateSchwarzschildRadius(particleName) {
            // This would calculate the actual Schwarzschild radius for the particle
            // For now, we'll show the black hole's radius
            document.getElementById('schwarzschildRadius').textContent = (2 * M).toFixed(3);
        }
        
        function mountCamera(particleName) {
            const observerIndicator = scene.getObjectByName('observerIndicator');
            
            if (mountedParticle === particleName) {
                // Unmount
                mountedParticle = null;
                setView('third');
                document.getElementById('particleTensorInfo').style.display = 'none';
                // Show observer indicator when unmounting
                if (observerIndicator) {
                    observerIndicator.visible = true;
                }
            } else {
                // Mount
                mountedParticle = particleName;
                document.getElementById('particleTensorInfo').style.display = 'block';
                updateTensorInfo();
                // Hide observer indicator when mounting camera to particle
                if (observerIndicator) {
                    observerIndicator.visible = false;
                }
            }
            
            // Update UI
            document.querySelectorAll('.particle-control').forEach(control => {
                control.classList.remove('mounted');
            });
            
            if (mountedParticle) {
                const controls = document.getElementById('particleControls').children;
                for (const control of controls) {
                    if (control.querySelector('.particle-name').textContent.toLowerCase() === particleName) {
                        control.classList.add('mounted');
                        break;
                    }
                }
            }
        }
        
        function updateTensorInfo() {
            if (!mountedParticle || !currentTheory) return;
            
            const theoryData = runData[currentTheory];
            const particleData = theoryData.particles[mountedParticle];
            
            if (!particleData) return;
            
            // Calculate current state based on animation time
            const timeIndex = Math.floor(animationTime * (particleData.positions.length - 1));
            const position = particleData.positions[Math.min(timeIndex, particleData.positions.length - 1)];
            const velocity = particleData.velocities ? particleData.velocities[timeIndex] : [0, 0];
            
            // Display tensor components
            const tensorContent = document.getElementById('tensorContent');
            tensorContent.innerHTML = `
                <p><strong>Position:</strong> r = ${position[0].toFixed(3)} M, φ = ${position[1].toFixed(3)} rad</p>
                <p><strong>Velocity:</strong> ṙ = ${velocity[0].toFixed(3)}, φ̇ = ${velocity[1].toFixed(3)}</p>
                <p><strong>4-Velocity:</strong> uᵘ = (${1}, ${velocity[0].toFixed(3)}, 0, ${velocity[1].toFixed(3)})</p>
                <p><strong>Metric:</strong> gₜₜ = ${(1 - 2*M/position[0]).toFixed(4)}</p>
            `;
            
            // Display degrees of freedom
            const dofContent = document.getElementById('dofContent');
            dofContent.innerHTML = `
                <div class="dof-item">• Radial motion: ${Math.abs(velocity[0]) > 0.01 ? 'Active' : 'Constrained'}</div>
                <div class="dof-item">• Angular motion: ${Math.abs(velocity[1]) > 0.01 ? 'Active' : 'Constrained'}</div>
                <div class="dof-item">• Energy: Conserved</div>
                <div class="dof-item">• Angular momentum: Conserved</div>
            `;
        }
        
        function toggleSpacetimeGrid() {
            const checkbox = document.getElementById('gridToggle');
            if (spacetimeGrid) {
                spacetimeGrid.visible = checkbox.checked;
            }
        }
        
        function onMouseMove(event) {
            // Calculate mouse position in normalized device coordinates
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            // Update raycaster
            raycaster.setFromCamera(mouse, camera);
            
            // Check for intersections
            const objects = [...Object.values(particles), blackHole].filter(obj => obj && obj.visible);
            const intersects = raycaster.intersectObjects(objects);
            
            if (intersects.length > 0) {
                const object = intersects[0].object;
                if (object !== hoveredObject) {
                    hoveredObject = object;
                    showTooltip(event, object);
                }
                updateTooltipPosition(event);
            } else {
                hoveredObject = null;
                hideTooltip();
            }
        }
        
        function onMouseClick(event) {
            if (hoveredObject) {
                selectedObject = hoveredObject;
                showObjectInfo(selectedObject);
            }
        }
        
        function showTooltip(event, object) {
            const tooltip = document.getElementById('tooltip');
            
            if (object.userData.type === 'particle') {
                tooltip.innerHTML = `
                    <strong>${object.name.charAt(0).toUpperCase() + object.name.slice(1)}</strong><br>
                    Click for detailed information
                `;
            } else if (object.userData.type === 'blackhole') {
                tooltip.innerHTML = `
                    <strong>Black Hole</strong><br>
                    Mass: ${blackHoleMass.toExponential(2)} kg<br>
                    Schwarzschild Radius: ${(2 * M).toFixed(3)} M<br>
                    Click for more details
                `;
            }
            
            tooltip.style.display = 'block';
            updateTooltipPosition(event);
        }
        
        function updateTooltipPosition(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.left = (event.clientX + 15) + 'px';
            tooltip.style.top = (event.clientY - 15) + 'px';
        }
        
        function hideTooltip() {
            document.getElementById('tooltip').style.display = 'none';
        }
        
        function showObjectInfo(object) {
            const info = document.getElementById('objectInfo');
            
            if (object.userData.type === 'particle') {
                const theoryData = runData[currentTheory];
                const particleData = theoryData.particles[object.name];
                
                info.innerHTML = `
                    <h3>${object.name.charAt(0).toUpperCase() + object.name.slice(1)} Properties</h3>
                    <p><strong>Theory:</strong> ${currentTheory}</p>
                    <p><strong>Trajectory Points:</strong> ${particleData.positions.length}</p>
                    <p><strong>Current Position:</strong> r = ${currentPositions[object.name][0].toFixed(3)} M</p>
                    <p><strong>Particle Type:</strong> ${getParticleType(object.name)}</p>
                    <p><strong>Key Features:</strong> ${getParticleFeatures(object.name)}</p>
                    <button class="button" onclick="closeObjectInfo()">Close</button>
                `;
            } else if (object.userData.type === 'blackhole') {
                info.innerHTML = `
                    <h3>Black Hole Information</h3>
                    <p><strong>Type:</strong> Primordial Mini Black Hole</p>
                    <p><strong>Mass:</strong> ${blackHoleMass.toExponential(2)} kg</p>
                    <p><strong>Schwarzschild Radius:</strong> ${(2 * M).toFixed(3)} M</p>
                    <p><strong>Event Horizon:</strong> r = ${(2 * M).toFixed(3)} M</p>
                    <p><strong>Photon Sphere:</strong> r = ${(3 * M).toFixed(3)} M</p>
                    <p><strong>ISCO:</strong> r = ${(6 * M).toFixed(3)} M</p>
                    <button class="button" onclick="closeObjectInfo()">Close</button>
                `;
            }
            
            info.style.display = 'block';
        }
        
        function closeObjectInfo() {
            document.getElementById('objectInfo').style.display = 'none';
        }
        
        function getParticleType(name) {
            const types = {
                electron: 'Fermion (Lepton)',
                neutrino: 'Fermion (Lepton)',
                photon: 'Boson (Gauge)',
                proton: 'Fermion (Baryon)'
            };
            return types[name] || 'Unknown';
        }
        
        function getParticleFeatures(name) {
            const features = {
                electron: 'Charged, massive, stable',
                neutrino: 'Neutral, nearly massless, weakly interacting',
                photon: 'Massless, travels at c, electromagnetic',
                proton: 'Charged, massive, stable (in most theories)'
            };
            return features[name] || 'Standard particle';
        }
        
        function setView(viewType) {
            currentView = viewType;
            
            switch (viewType) {
                case 'third':
                    // Position camera to see typical orbits at ~100 M
                    camera.position.set(150, 100, 150);
                    camera.lookAt(0, 0, 0);
                    controls.target.set(0, 0, 0);
                    controls.enabled = true;
                    controls.update();
                    document.getElementById('viewInfo').textContent = 'Third Person View - Use mouse to orbit';
                    break;
                    
                case 'top':
                    camera.position.set(0, 200, 0);
                    camera.lookAt(0, 0, 0);
                    controls.target.set(0, 0, 0);
                    controls.enabled = true;
                    controls.update();
                    document.getElementById('viewInfo').textContent = 'Top View - Looking down at orbital plane';
                    break;
            }
        }
        
        function resetCamera() {
            setView(currentView);
        }
        
        function toggleAnimation() {
            isPlaying = !isPlaying;
            document.getElementById('playPauseBtn').textContent = isPlaying ? 'Pause' : 'Play';
        }
        
        function resetAnimation() {
            animationTime = 0;
            document.getElementById('timeSlider').value = 0;
            updateTimeDisplay();
        }
        
        function updateSpeed(event) {
            animationSpeed = parseFloat(event.target.value);
            document.getElementById('speedValue').textContent = animationSpeed.toFixed(1);
        }
        
        function updateTimeFromSlider(event) {
            animationTime = parseFloat(event.target.value) / 100;
            updateTimeDisplay();
        }
        
        function updateTimeDisplay() {
            document.getElementById('timeValue').textContent = (animationTime * 100).toFixed(1);
            document.getElementById('timeSlider').value = animationTime * 100;
        }
        
        function updateLegend() {
            const legendDiv = document.getElementById('legend');
            legendDiv.innerHTML = '';
            
            for (const [name, color] of Object.entries(particleColors)) {
                if (particles[name]) {
                    const item = document.createElement('div');
                    item.className = 'legend-item';
                    
                    const colorBox = document.createElement('div');
                    colorBox.className = 'legend-color';
                    colorBox.style.backgroundColor = `#${color.toString(16).padStart(6, '0')}`;
                    
                    const label = document.createElement('span');
                    label.textContent = name.charAt(0).toUpperCase() + name.slice(1);
                    
                    item.appendChild(colorBox);
                    item.appendChild(label);
                    legendDiv.appendChild(item);
                }
            }
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (isPlaying && currentTheory) {
                animationTime += 0.001 * animationSpeed;
                if (animationTime > 1) {
                    animationTime = 0;
                }
                updateTimeDisplay();
                
                // Update particle positions
                const theoryData = runData[currentTheory];
                for (const [particleName, data] of Object.entries(theoryData.particles || {})) {
                    if (data && data.positions && particles[particleName]) {
                        const index = Math.floor(animationTime * (data.positions.length - 1));
                        const position = data.positions[Math.min(index, data.positions.length - 1)];
                        updateParticlePosition(particleName, position);
                    }
                }
                
                // Update overlay particle positions if overlay is active
                if (overlayTheory) {
                    const overlayData = runData[overlayTheory];
                    for (const [particleName, data] of Object.entries(overlayData.particles || {})) {
                        if (data && data.positions && overlayParticles[particleName]) {
                            const index = Math.floor(animationTime * (data.positions.length - 1));
                            const position = data.positions[Math.min(index, data.positions.length - 1)];
                            updateOverlayParticlePosition(particleName, position);
                        }
                    }
                }
                
                // Update tensor info if camera is mounted
                if (mountedParticle) {
                    updateTensorInfo();
                    
                    // Follow mounted particle but keep black hole in view
                    const particle = particles[mountedParticle];
                    if (particle) {
                        // Get particle position in r, phi coordinates
                        const pos = currentPositions[mountedParticle];
                        if (pos) {
                            const r = pos[0];
                            const phi = pos[1];
                            
                            // Place camera behind and above the particle on the curved surface
                            const cameraR = r + 10;
                            const cameraPhi = phi - 0.2; // Slightly behind
                            
                            // Calculate camera position on curved surface
                            const cameraX = cameraR * Math.cos(cameraPhi);
                            const cameraZ = cameraR * Math.sin(cameraPhi);
                            const cameraHeight = cameraR > 2 ? -2 * Math.sqrt(2 * M * (cameraR - 2 * M)) : 0;
                            
                            camera.position.set(
                                cameraX,
                                cameraHeight * 2 + 20, // Above the curved surface
                                cameraZ
                            );
                            
                            // Always look at the black hole center
                            camera.lookAt(0, -10, 0); // Look at bottom of the well
                            controls.target.set(0, -10, 0);
                        }
                    }
                }
            }
            
            // Always update spacetime grid to show dynamic curvature
            updateSpacetimeGrid();
            
            // Update observer indicator to show camera position
            const observerIndicator = scene.getObjectByName('observerIndicator');
            if (observerIndicator) {
                observerIndicator.position.copy(camera.position);
                observerIndicator.lookAt(0, 0, 0);
                observerIndicator.rotateX(Math.PI / 2); // Point cone toward black hole
            }
            
            // Update controls (but keep target on black hole)
            controls.target.set(0, 0, 0);
            controls.update();
            
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function updateOverlayParticlePosition(particleName, position) {
            const particle = overlayParticles[particleName];
            if (!particle) return;
            
            const r = position[0];
            const phi = position[1];
            
            // Position overlay particle on curved spacetime surface
            particle.position.x = r * Math.cos(phi);
            particle.position.z = r * Math.sin(phi);
            
            // Apply Flamm's paraboloid embedding
            const height = r > 2 ? -2 * Math.sqrt(2 * M * (r - 2 * M)) : 0;
            particle.position.y = height * 2;
        }
        
        function fitCameraToScene() {
            // Calculate bounding box of all trajectories
            const box = new THREE.Box3();
            
            // Include black hole
            if (blackHole) {
                box.expandByObject(blackHole);
            }
            
            // Include all trajectory lines
            for (const line of Object.values(trajectoryLines)) {
                if (line && line.visible) {
                    box.expandByObject(line);
                }
            }
            
            if (!box.isEmpty()) {
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());
                const maxDim = Math.max(size.x, size.y, size.z);
                
                // Position camera to see entire scene
                const distance = maxDim * 2;
                camera.position.set(distance * 0.8, distance * 0.6, distance * 0.8);
                camera.lookAt(center);
                
                // Update controls
                controls.target.copy(center);
                controls.update();
            }
        }
        
        // Initialize
        init();
    </script>
</body>
</html>