<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validation & Testing Pipeline</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://unpkg.com/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
        }
        .header {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        h1 {
            color: #2c3e50;
            margin: 0 0 10px 0;
        }
        .subtitle {
            color: #7f8c8d;
            font-size: 18px;
        }
        .section {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .test-card {
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .test-card:hover {
            border-color: #3498db;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .test-type {
            position: absolute;
            top: 0;
            right: 0;
            padding: 5px 15px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        .analytical { background-color: #3498db; }
        .solver-based { background-color: #e74c3c; }
        .test-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .test-description {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .test-metric {
            background-color: #ecf0f1;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            display: inline-block;
            margin: 2px;
        }
        .flow-diagram {
            background-color: #2c3e50;
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
            overflow-x: auto;
        }
        .flow-step {
            display: inline-block;
            background-color: #34495e;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 5px;
            position: relative;
        }
        .flow-step::after {
            content: '→';
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            color: #ecf0f1;
        }
        .flow-step:last-child::after {
            display: none;
        }
        .loss-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        .metric-card {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .metric-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .metric-formula {
            font-family: 'Consolas', 'Monaco', monospace;
            background-color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            margin-top: 10px;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }
        .implementation-note {
            background-color: #fef9e7;
            border-left: 4px solid #f39c12;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .code-reference {
            font-family: 'Consolas', 'Monaco', monospace;
            background-color: #34495e;
            color: #ecf0f1;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Validation & Testing Pipeline</h1>
            <p class="subtitle">How gravitational theories are tested for accuracy and physical validity</p>
        </div>

        <div class="section">
            <h2>Testing Flow Overview</h2>
            <div class="mermaid" style="background-color: #2c3e50; padding: 20px; border-radius: 10px; margin: 20px 0;">
                flowchart TD
                    START[Theory Input] --> DETECT{Quantum<br/>Theory?}
                    
                    DETECT -->|Yes| QPATH["🔬 QUANTUM TESTING PATH 🔬<br/>PennyLane Integration"]
                    DETECT -->|No| CPATH[Classical Testing Path]
                    
                    QPATH --> QTEST[Quantum-Specific Tests]
                    QTEST --> PLTEST["PennyLane Circuit Tests<br/>- Hamiltonian simulation<br/>- Quantum state evolution<br/>- Entanglement measures"]
                    QTEST --> PITEST["Path Integral Tests<br/>- Monte Carlo sampling<br/>- WKB approximation<br/>- Transition amplitudes"]
                    
                    CPATH --> ATEST[Analytical Validators]
                    QPATH --> ATEST
                    
                    ATEST --> TESTS["Standard Tests<br/>- Mercury Precession<br/>- Light Deflection<br/>- Photon Sphere<br/>- PPN Parameters<br/>- COW Interferometry<br/>- PSR J0740"]
                    
                    TESTS --> TRAJ[Trajectory Integration]
                    PLTEST --> TRAJ
                    PITEST --> TRAJ
                    
                    TRAJ --> SOLVER{Select Solver}
                    SOLVER -->|Quantum| QSOLV["QuantumPathIntegrator<br/>or<br/>QuantumCorrectedGeodesicSolver"]
                    SOLVER -->|Classical| CSOLV["Classical Geodesic Solvers<br/>(4D or 6D)"]
                    
                    QSOLV --> PENNY["PennyLane Execution<br/>qml.device('default.qubit')<br/>Quantum circuits<br/>Measurements"]
                    
                    PENNY --> LOSS[Loss Calculation]
                    CSOLV --> LOSS
                    
                    LOSS --> METRICS["Loss Metrics<br/>- trajectory_mse<br/>- fft<br/>- endpoint_mse<br/>- cosine<br/>+ Quantum fidelity"]
                    
                    METRICS --> VIZ["Visualization<br/>- 3D trajectories<br/>- Quantum corrections<br/>- Baseline comparisons"]
                    
                    VIZ --> RANK[Theory Ranking]
                    
                    style QPATH fill:#e91e63,stroke:#ad1457,stroke-width:4px,color:#fff
                    style QTEST fill:#9b59b6,stroke:#8e44ad,stroke-width:2px,color:#fff
                    style PLTEST fill:#ff5722,stroke:#d84315,stroke-width:2px,color:#fff
                    style PITEST fill:#ff5722,stroke:#d84315,stroke-width:2px,color:#fff
                    style PENNY fill:#ff5722,stroke:#d84315,stroke-width:3px,color:#fff
                    style QSOLV fill:#9b59b6,stroke:#8e44ad,stroke-width:2px,color:#fff
            </div>
        </div>

        <div class="section">
            <h2>Analytical Validators</h2>
            <p>These tests use mathematical approximations to validate theory predictions without running full simulations:</p>
            
            <div class="test-grid">
                <div class="test-card">
                    <span class="test-type analytical">ANALYTICAL</span>
                    <div class="test-name">Mercury Precession</div>
                    <div class="test-description">Tests perihelion advance using weak-field approximation</div>
                    <div class="test-metric">Expected: 42.98 arcsec/century</div>
                    <div class="test-metric">Tolerance: ±0.01</div>
                    <div style="margin-top: 10px;">
                        <code class="code-reference">mercury_precession_validator.py</code>
                    </div>
                </div>

                <div class="test-card">
                    <span class="test-type analytical">ANALYTICAL</span>
                    <div class="test-name">Light Deflection</div>
                    <div class="test-description">Calculates light bending near massive objects using PPN γ parameter</div>
                    <div class="test-metric">γ parameter test</div>
                    <div class="test-metric">Weak-field limit</div>
                    <div style="margin-top: 10px;">
                        <code class="code-reference">light_deflection_validator.py</code>
                    </div>
                </div>

                <div class="test-card">
                    <span class="test-type analytical">ANALYTICAL</span>
                    <div class="test-name">Photon Sphere</div>
                    <div class="test-description">Finds radius where light can orbit using effective potential extremum</div>
                    <div class="test-metric">r = 3M for Schwarzschild</div>
                    <div class="test-metric">Circular null orbits</div>
                    <div style="margin-top: 10px;">
                        <code class="code-reference">photon_sphere_validator.py</code>
                    </div>
                </div>

                <div class="test-card">
                    <span class="test-type analytical">ANALYTICAL</span>
                    <div class="test-name">PPN Parameters</div>
                    <div class="test-description">Tests post-Newtonian parameters γ and β from metric expansion</div>
                    <div class="test-metric">γ = 1 in GR</div>
                    <div class="test-metric">β = 1 in GR</div>
                    <div style="margin-top: 10px;">
                        <code class="code-reference">ppn_validator.py</code>
                    </div>
                </div>

                <div class="test-card">
                    <span class="test-type analytical">ANALYTICAL</span>
                    <div class="test-name">COW Interferometry</div>
                    <div class="test-description">Tests gravitational phase shift in neutron interferometry</div>
                    <div class="test-metric">Metric gradient calculation</div>
                    <div class="test-metric">Quantum phase shifts</div>
                    <div style="margin-top: 10px;">
                        <code class="code-reference">cow_interferometry_validator.py</code>
                    </div>
                </div>

                <div class="test-card">
                    <span class="test-type analytical">ANALYTICAL</span>
                    <div class="test-name">PSR J0740</div>
                    <div class="test-description">Validates Shapiro time delay for pulsar timing</div>
                    <div class="test-metric">Binary pulsar system</div>
                    <div class="test-metric">Relativistic delay</div>
                    <div style="margin-top: 10px;">
                        <code class="code-reference">psr_j0740_validator.py</code>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Trajectory Integration Tests</h2>
            <p>These tests run actual numerical integrations and compare against baselines:</p>
            
            <div class="test-grid">
                <div class="test-card">
                    <span class="test-type solver-based">SOLVER-BASED</span>
                    <div class="test-name">Trajectory vs Kerr</div>
                    <div class="test-description">1000-step integration comparing to Kerr baseline</div>
                    <div class="test-metric">MSE loss calculation</div>
                    <div class="test-metric">Multiple particles</div>
                    <div style="margin-top: 10px;">
                        <code class="code-reference">test_comprehensive_final.py:245</code>
                    </div>
                </div>

                <div class="test-card">
                    <span class="test-type solver-based">SOLVER-BASED</span>
                    <div class="test-name">Circular Orbit Period</div>
                    <div class="test-description">Tests conservation laws via circular orbit stability</div>
                    <div class="test-metric">Energy conservation</div>
                    <div class="test-metric">Angular momentum</div>
                    <div style="margin-top: 10px;">
                        <code class="code-reference">test_comprehensive_final.py:135</code>
                    </div>
                </div>

                <div class="test-card">
                    <span class="test-type solver-based">SOLVER-BASED</span>
                    <div class="test-name">Quantum Geodesic Sim</div>
                    <div class="test-description">Path integral validation for quantum theories</div>
                    <div class="test-metric">WKB approximation</div>
                    <div class="test-metric">Stationary phase</div>
                    <div class="test-metric">PennyLane circuits</div>
                    <div style="margin-top: 10px;">
                        <code class="code-reference">test_comprehensive_final.py:207</code>
                    </div>
                </div>
                
                <div class="test-card" style="border-color: #9b59b6;">
                    <span class="test-type solver-based" style="background-color: #9b59b6;">QUANTUM</span>
                    <div class="test-name" style="color: #9b59b6;">PennyLane Integration</div>
                    <div class="test-description">Quantum circuit simulation for trajectory corrections</div>
                    <div class="test-metric">Hamiltonian evolution</div>
                    <div class="test-metric">Quantum entanglement</div>
                    <div class="test-metric">State measurements</div>
                    <div style="margin-top: 10px;">
                        <code class="code-reference">QuantumCorrectedGeodesicSolver</code>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Loss Metrics</h2>
            <p>Four different loss types are computed to quantify deviation from General Relativity baselines:</p>
            
            <div class="loss-metrics">
                <div class="metric-card">
                    <div class="metric-name">trajectory_mse</div>
                    <div>Mean squared error of full trajectory</div>
                    <div class="metric-formula">MSE = Σ(r_theory - r_baseline)² / N</div>
                </div>

                <div class="metric-card">
                    <div class="metric-name">fft</div>
                    <div>Frequency domain comparison</div>
                    <div class="metric-formula">Loss = ||FFT(theory) - FFT(baseline)||</div>
                </div>

                <div class="metric-card">
                    <div class="metric-name">endpoint_mse</div>
                    <div>Final position deviation</div>
                    <div class="metric-formula">Loss = ||position_final - baseline_final||²</div>
                </div>

                <div class="metric-card">
                    <div class="metric-name">cosine</div>
                    <div>Angular similarity of trajectory shapes</div>
                    <div class="metric-formula">Similarity = cos(θ) = (A·B)/(|A||B|)</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Loss Calculation Implementation</h2>
            <div class="implementation-note">
                <strong>Key Implementation:</strong> Loss calculation happens in <code class="code-reference">theory_engine_core.py:2790-2799</code>
            </div>
            
            <pre style="background-color: #2c3e50; color: #ecf0f1; padding: 20px; border-radius: 8px; overflow-x: auto;">
# Compare actual trajectory paths using stable numerical methods
loss = engine.loss_calculator.compute_trajectory_loss(
    theory_trajectory, baseline_hist, loss_type
)
loss_results[loss_type][baseline_name] = loss</pre>
        </div>

        <div class="section">
            <h2>Visualization Output</h2>
            <p>Each theory generates visualization files showing:</p>
            <ul>
                <li><strong>3D Trajectory Plots</strong>: X-Y plane with time as Z-axis</li>
                <li><strong>Event Horizon</strong>: Black sphere at r = 2M</li>
                <li><strong>Particle Colors</strong>:
                    <span style="color: blue;">● Electron (blue)</span>,
                    <span style="color: #FFD700;">● Photon (gold)</span>,
                    <span style="color: red;">● Proton (red)</span>,
                    <span style="color: green;">● Neutrino (green)</span>
                </li>
                <li><strong>Baseline Comparisons</strong>: Dashed lines for Schwarzschild/Kerr</li>
                <li><strong>Start/End Markers</strong>: Green circle (start), red square (end)</li>
            </ul>
            
            <div class="implementation-note">
                <strong>Visualization Code:</strong> <code class="code-reference">theory_visualizer.py:36-662</code>
            </div>
        </div>

        <div class="section">
            <h2>Performance Metrics</h2>
            <div class="chart-container">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Create performance comparison chart
        const ctx = document.getElementById('performanceChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['4D Symmetric', '6D General', 'Quantum Path Integral'],
                datasets: [{
                    label: 'Relative Computation Time',
                    data: [1, 3.5, 8],
                    backgroundColor: ['#27ae60', '#e67e22', '#9b59b6'],
                    borderColor: ['#229954', '#d35400', '#8e44ad'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Relative Time (4D = 1.0)'
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'Solver Performance Comparison',
                        font: {
                            size: 16
                        }
                    }
                }
            }
        });

        // Add hover effects to test cards
        document.querySelectorAll('.test-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.backgroundColor = '#f8f9fa';
            });
            card.addEventListener('mouseleave', function() {
                this.style.backgroundColor = 'white';
            });
        });
    </script>
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'dark',
            flowchart: {
                curve: 'basis'
            }
        });
    </script>
</body>
</html>